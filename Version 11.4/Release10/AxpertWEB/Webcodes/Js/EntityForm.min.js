/*https://web.agile-labs.com/minZIP/*//*version=3.9.1*/function ownKeys(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),a.push.apply(a,n)}return a}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(a),!0).forEach(function(e){_defineProperty(t,e,a[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):ownKeys(Object(a)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))})}return t}function _defineProperty(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_unsupportedIterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t))return _arrayLikeToArray(t)}function _createForOfIteratorHelper(t,e){var a="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!a){if(Array.isArray(t)||(a=_unsupportedIterableToArray(t))||e&&t&&"number"==typeof t.length){a&&(t=a);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,c=!0,r=!1;return{s:function(){a=a.call(t)},n:function(){var t=a.next();return c=t.done,t},e:function(t){r=!0,o=t},f:function(){try{c||null==a["return"]||a["return"]()}finally{if(r)throw o}}}}function _slicedToArray(t,e){return _arrayWithHoles(t)||_iterableToArrayLimit(t,e)||_unsupportedIterableToArray(t,e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);return"Object"===a&&t.constructor&&(a=t.constructor.name),"Map"===a||"Set"===a?Array.from(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?_arrayLikeToArray(t,e):void 0}}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,n=new Array(e);a<e;a++)n[a]=t[a];return n}function _iterableToArrayLimit(t,e){var a=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=a){var n,i,o=[],c=!0,r=!1;try{for(a=a.call(t);!(c=(n=a.next()).done)&&(o.push(n.value),!e||o.length!==e);c=!0);}catch(s){r=!0,i=s}finally{try{c||null==a["return"]||a["return"]()}finally{if(r)throw i}}return o}}function _arrayWithHoles(t){if(Array.isArray(t))return t}function _typeof(t){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _createClass(t,e,a){return e&&_defineProperties(t.prototype,e),a&&_defineProperties(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}var _entityForm,_entityCommon,iframeindex=-1,EntityForm=function(){function t(){_classCallCheck(this,t),this.components={N:{html:'<input type="number" class="inputcontent1" value="{{value}}" readonly>'},ST:{html:'<div class="inputcontent"  readonly>{{value}}</div>'},S:{html:'<div class="inputcontent"  readonly>{{v}}</div>'},M:{html:'<div class="inputcontent"  readonly>{{v}}</div>'},C:{html:'<div class="inputcontent"  readonly>{{v}}</div>'},RT:{html:'<p class="add-read-more show-less-content" >{{value}}</p><br>'},LT:{html:'<p class="add-read-more show-less-content" >{{value}}</p><br>'},D:{html:'<input type="date" class="form-control form-control-sm w-auto" value="{{value}}" readonly/>'},ATT:{html:' <div id="{{customid}}" class="Files-Attached ATT float-start" onclick="_entityForm.downloadFileAttachment(\'{{v}}\',\'{{filepath}}\')" data-filename="{{v}}" data-filepath="{{filepath}}" role="button">\n                                  {{componentimg}}\n                               <div class="mx-3 fw-semibold attachmenttxt">\n                               <a class="attached-filename" data-bs-toggle="tooltip" data-bs-placement="bottom" title="{{v}}">{{v}}</a>\n                            </div>\n                       </div>'},AXPFILE_ATT:{html:' <div id="{{customid}}" class="Files-Attached AXPFILE_ATT float-start" onclick="_entityForm.downloadAxpFileAttachment(\'{{fieldid}}\',\'{{v}}\',\'{{scriptspath}}/axpert/{{sid}}/{{v}}\',event, this)" data-filename="{{v}}" data-filepath="{{filepath}}" role="button">\n                                  {{componentimg}}\n                               <div class="mx-3 fw-semibold attachmenttxt">\n                               <a class="attached-filename" data-bs-toggle="tooltip" data-bs-placement="bottom" title="{{v}}">{{v}}</a>\n                            </div>\n                       </div>'},GRID_ATT:{html:' <div id="{{customid}}" class="Files-Attached GRID_ATT float-start" onclick="_entityForm.showGridAttLink(\'{{v}}\')" data-filename="{{v}}" role="button">\n                                  {{componentimg}}\n                               <div class="mx-3 fw-semibold attachmenttxt">\n                               <a class="attached-filename" data-bs-toggle="tooltip" data-bs-placement="bottom" title="{{v}}">{{v}}</a>\n                            </div>\n                       </div>'},Image:{html:'<img src="{{src}}" style="width:150px;" height="100" onerror="this.onerror=null;this.src=\'../images/no image.png\';">'},togglebutton:{html:'<div class="form-check form-switch">\n                  <input class="form-check-input" type="checkbox" role="switch" {{checked}} onclick="return false;" />\n                </div>'}},this.fldtype=["N","ST","D","LT","RT","ATT","Image","table","togglebutton"],this.flds={},this.entityFormJson={},this.pageSize=5,this.emptyRowsHtml="No data found",this.hideControls=[],this.connectedData={},this.connectedData.accordion='<div class="Project_items">\n                <div class="card  ">\n                    <div class="col-xl-12 col-md-12 d-flex flex-column flex-column-fluid   ">\n                        <div class="page-Header">\n                            <div class="card-title collapsible cursor-pointer rotate" data-bs-toggle="collapse"\n                                aria-expanded="true" data-bs-target="#Sub-Entity_wrapper">\n                                <div class="symbol symbol-25px symbol-circle initialized"\n                                    onclick="_entityForm.openEntityPage(\'{{transid}}\')" data-toggle="tooltip" >\n                                    <span class="symbol-label bg-warning text-inverse-warning fw-bold"\n                                        style="height:30px !important; width:30px !important;">{{initial}}</span>\n                                </div>\n                                <span class="Project_title"\n                                    onclick="_entityForm.fetchConnectedDataRecords(\'{{caption}}\', \'{{transid}}\')">{{caption}}</span>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                <div class=" row">\n                    <div class="col">Count :</div>\n                    <div class="col fw-bold" >{{totrec}}</div>\n                </div>\n            </div>',this.connectedData.accordionWrapper='<div class="row connecteddata-accordions" style="position: relative; right: 3px;" data-transid="{{transid}}">\n                <div class="dc-heading card-title cursor-pointer collapsible  rotate  collapsed " data-bs-toggle="collapse"\n                    aria-expanded="true" data-bs-target="#sub-entitycontainer-{{transid}}" data-transid="{{transid}}">\n                    <span class="material-icons material-icons-style material-icons-2 rotate-180">expand_circle_down\n                    </span>\n                    <span class="material-icons material-icons-style material-icons-2">account_tree</span>\n                    {{caption}}\n                    <span class="badge badge-dark mx-5">{{totrec}}</span>\n                    <div class="card-toolbar">\n                        <div class="Tkts-toolbar-Right">\n\n                            <button type="button" data-transid="{{transid}}" data-caption="{{caption}}" id="SubEntity-add-btn-{{transid}}" class="btn btn-icon btn-white btn-color-gray-600 btn-active-primary shadow-sm  tb-btn btn-sm subentity-add" data-toggle="tooltip" title="New">\n                                <span class="material-icons material-icons-style material-icons-2">add\n                                </span>\n                            </button>\n\n                            <button type="button" data-transid="{{transid}}" data-caption="{{caption}}"  id="SubEntity-list-btn-{{transid}}" class="btn btn-icon btn-white btn-color-gray-600 btn-active-primary shadow-sm  tb-btn btn-sm  subentity-list" data-toggle="tooltip" title="List View">\n                                <span class="material-icons material-icons-style material-icons-2">format_list_bulleted\n                                </span>\n                            </button>\n\n                        </div>\n                    </div>\n                    \x3c!--end::Toolbar--\x3e\n\n                </div>\n\n                <div id="sub-entitycontainer-{{transid}}" class="row sub-entity-row collapse">\n                    <div class="Entity_Form_SubEntity body_Container">\n                    </div>\n                </div>\n\n            </div>',this.connectedData.tabMenu='<li class="nav-item w-100 me-0 mb-md-2" role="presentation">\n                <a class="nav-link w-100 btn btn-flex btn-active-light-primary" data-bs-toggle="tab"\n                    href="#kt_vtab_pane_{{transid}}" aria-selected="true" role="tab">\n                    <i class="ki-duotone ki-icons/duotune/general/gen001.svg fs-2 text-primary me-3"></i> <span\n                        class="d-flex flex-column align-items-start">\n                        <span class="fs-4 fw-bold">{{caption}} ({{transid}})</span>\n                    </span>\n                </a>\n            </li>',this.connectedData.tabBody='<div class="tab-pane fade" id="kt_vtab_pane_{{transid}}" role="tabpanel">\n                <div class="table-responsive" id="connecteddata-fieldslist-{{transid}}">                                        \n                </div>\n            </div>',this.entityName="",this.entityTransId="",this.recordId="",this.keyValue="",this.metaData={},this.entityWiseMetaData={},this.entityWiseFields={},this.subEntityMapping={},this.listJson={},this.maxPageNumber=1,this.pageSize=100,this.chartsMetaData=[],this.subEntityList={},this.selectedCharts="",this.selectedSubEntities="",this.subEntityFilter,this.selectedChartsObj={},this.activitiesExpanded=!1,this.isSubEntitiesAvailable=!0,this.emptyRowsHtml="No data found",this.editable=!0,this.keyField="",this.connectedDataFields={},this.customHyperLinks=[],this.customDataSource=!1,this.relatedDataFields="",this.relatedDataDisplayFields="",this.relatedDataDisplayGridFields=""}return _createClass(t,[{key:"init",value:function(){var t=this;try{var e,a,n=window.location.search,i=new URLSearchParams(n);this.entityTransId=i.get("tstid"),this.recordId=i.get("recid")||i.get("recordid")||"0";var o,c,r=JSON.parse(document.querySelector("#hdnEntityFormPageMetaData").value),s=document.querySelector("#hdnEntityFormPageData").value.split("*$*")[1].replaceAll("<br/>","").replaceAll("<br />","").replaceAll("<br>",""),l=JSON.parse(s);if(t.hideControls=(null===(e=l.data.find(function(t){var e;return"axro_hidecontrols"==(null===(e=t.n)||void 0===e?void 0:e.toLowerCase())}))||void 0===e?void 0:null===(a=e.v)||void 0===a?void 0:a.toLowerCase().split(","))||[],t.entityFormJson.data=l.data,t.entityFormJson.metadata=r.result.data.FormMetaData,t.entityFormJson.error=l.error,t.metaData=r.result.data.SubEntityMetaData,t.properties=r.result.data.Properties,t.entityName=r.result.data.EntityName,t.keyField=r.result.data.KeyField,t.customDataSource=r.result.data.DataSource,t.entityTransId=r.result.data.TransId,_entityCommon.isValid(t.properties.CONNECTEDDATA_CONFIG)){var d=JSON.parse(t.properties.CONNECTEDDATA_CONFIG);t.connectedDataFields=d.CONNECTEDDATA_METRICS||{},t.customHyperLinks=d.HYPERLINKS||[],t.relatedDataFields=d.RELATEDDATAFIELDS||"",t.relatedDataDisplayFields=d.DISPLAYFIELDS||"",t.relatedDataDisplayGridFields=d.DISPLAYGRIDFIELDS||""}if(t.customDataSource||!_entityCommon.inValid(t.properties.CONNECTEDDATA_CONFIG))Object.values(JSON.parse(t.properties.CONNECTEDDATA_CONFIG)).some(function(t){return Array.isArray(t)?t.length>0:"object"===_typeof(t)&&null!==t?Object.keys(t).length>0:!!t})&&($("#Entity_management_Left").toggleClass("col-xl-8 col-md-7 col-xl-12 col-md-12"),$("#Entity_management_Right").removeClass("d-none"));if(_entityCommon.isValid(t.connectedDataFields)&&Object.keys(t.connectedDataFields).length>0&&(document.querySelector("#KPI-2").classList.remove("d-none"),document.querySelector("#NO-KPI-Items").classList.add("d-none"),document.querySelector(".right-connectedpagesdata").classList.remove("d-none")),t.recordId=t.entityFormJson.data.find(function(t){return"axp_recid1"==t.n}).v,_entityCommon.inValid(t.keyField))t.keyField=(null===(o=t.getKeyField(t.entityTransId))||void 0===o?void 0:o.fldname)||(null===(c=t.entityFormJson.data[2])||void 0===c?void 0:c.n)||"axp_recid1";t.keyValue=t.entityFormJson.data.find(function(e){return e.n==t.keyField}).v,t.keyValue=_entityCommon.replaceSpecialChars(t.keyValue);try{AxBeforeDataPageLoad(t)}catch(u){}if(t.constructEntityFormHTML(),document.querySelector("#EntityTitle").innerHTML=t.entityName+(t.keyValue?" - "+t.keyValue:""),axDisallowCreate)axDisallowCreate.split(",").indexOf(this.entityTransId)>-1&&(this.allowCreate=!1,document.querySelector("#add-entity").remove());t.parseSubEntityMetaDataJSON(),t.constructRightPanel(),t.bindEvents(),t.applyTheme();try{AxAfterDataPageLoad(t)}catch(m){}}catch(p){showAlertDialog("error","Error occurred. Please check with administrator."),console.log(p)}ShowHideDimmer(!1)}},{key:"constructRightPanel",value:function(){this.customDataSource&&this.constructCustomDataSourceAccordion(),this.customHyperLinks.length>0&&this.constructCustomHyperLinkAccordions(),this.getConnectedData()}},{key:"openNewTstruct",value:function(){var t={page:"Entity",transId:this.entityTransId,recordId:"0",action:"Create"};return _entityCommon.getEntityEditableFlag(t)?(_entityCommon.loadHyperLink("../aspx/tstruct.aspx?transid=".concat(this.entityTransId,"&dummyload=false")),!0):(showAlertDialog("error","User does not have 'Create' access for this screen. Please check with administrator."),!1)}},{key:"openSubEntityTstruct",value:function(t){var e,a,n,i,o="";null!==(e=this.subEntityMapping[t])&&void 0!==e&&e.mapfield&&null!==(a=this.subEntityMapping[t])&&void 0!==a&&a.mapsrcdata&&(o="act=open&".concat(null===(n=this.subEntityMapping[t])||void 0===n?void 0:n.mapfield,"=").concat(null===(i=this.subEntityMapping[t])||void 0===i?void 0:i.mapsrcdata));var c={page:"Entity",transId:t,recordId:"0",action:"Create"};return _entityCommon.getEntityEditableFlag(c)?(_entityCommon.loadHyperLink("../aspx/tstruct.aspx?transid=".concat(t,"&").concat(o,"&dummyload=false")),!0):(showAlertDialog("error","User does not have 'Create' access for this screen. Please check with administrator."),!1)}},{key:"editEntity",value:function(){var t={page:"EntityForm",transId:this.entityTransId,recordId:this.recordId,action:"Edit"};return _entityCommon.getEntityEditableFlag(t)?(_entityCommon.loadHyperLink("../aspx/tstruct.aspx?transid=".concat(this.entityTransId,"&act=load&recordid=").concat(this.recordId,"&dummyload=false")),!0):(showAlertDialog("error","User does not have 'Edit' access for this record. Please check with administrator."),!1)}},{key:"editSubEntity",value:function(t,e){var a={page:"EntityForm",transId:t,recordId:e,action:"Edit"};return _entityCommon.getEntityEditableFlag(a)?(_entityCommon.loadHyperLink("../aspx/tstruct.aspx?transid=".concat(t,"&act=load&recordid=").concat(e,"&dummyload=false")),!0):(showAlertDialog("error","User does not have 'Edit' access for this record. Please check with administrator."),!1)}},{key:"reloadEntityPage",value:function(){_entityCommon.loadHyperLink("../aspx/EntityForm.aspx?tstid=".concat(this.entityTransId,"&recid=").concat(this.recordId))}},{key:"openEntityForm",value:function(t,e,a,n){var i="../aspx/EntityForm.aspx?tstid=".concat(e,"&recid=").concat(a);_entityCommon.loadHyperLink(i)}},{key:"updateRelatedData",value:function(t,e){var a=this;window.top.entityNavList||(window.top.entityNavList={}),a.getNearestRecords(e).forEach(function(t){_entityCommon.inValid(t.entityname)&&(t.entityname=a.subEntityList[t.transid])}),window.top.entityNavList[t]=a.getNearestRecords(e),window.top.entityNavList.lastTransId=t,window.top.entityNavList.lastCaption="".concat(a.keyValue)}},{key:"openEntityPage",value:function(t){_entityCommon.inValid(t)&&(t=this.entityTransId),_entityCommon.loadHyperLink("../aspx/Entity.aspx?tstid=".concat(t))}},{key:"parseSubEntityMetaDataJSON",value:function(){var t=this,e={},a={},n={};t.metaData.filter(function(t){return"T"===t.subentity}).forEach(function(i){if(e[i.ftransid]||(e[i.ftransid]=i.fcaption||i.ftransid),a[i.ftransid]||(a[i.ftransid]={}),!_entityCommon.inValid(i.entityrelfld)){n[i.ftransid]||(n[i.ftransid]={}),n[i.ftransid].mapfieldjson=i,n[i.ftransid].mapfield=i.fldname,n[i.ftransid].mapdatafield=i.entityrelfld,n[i.ftransid].mapsrcfield=i.srcfield;var o=t.keyValue,c=t.keyValue;if("recordid"==i.entityrelfld&&i.srcfield){o=t.recordId.toString();var r=_entityForm.entityFormJson.data.filter(function(t){return t.n===i.srcfield});r.length&&(c=ReverseCheckSpecialChars(r[0].v))}if("recordid"!=i.entityrelfld||i.srcfield){if(i.srcfield){var s=_entityForm.entityFormJson.data.filter(function(t){return t.n===i.entityrelfld});s.length&&(o=ReverseCheckSpecialChars(s[0].v));var l=_entityForm.entityFormJson.data.filter(function(t){return t.n===i.srcfield});l.length&&(c=ReverseCheckSpecialChars(l[0].v))}else if(i.entityrelfld){var d=_entityForm.entityFormJson.data.filter(function(t){return t.n===i.entityrelfld});d.length&&(o=ReverseCheckSpecialChars(d[0].v));var u=_entityForm.entityFormJson.data.filter(function(t){return t.n===i.entityrelfld});u.length&&(c=ReverseCheckSpecialChars(u[0].v))}}else o=t.recordId.toString(),c=t.recordId.toString();n[i.ftransid].mapsrcdata=c,n[i.ftransid].mapdatavalue=o}a[i.ftransid][i.fldname]=i}),t.subEntityMapping=n,t.entityWiseMetaData=a,t.subEntityList=e,t.getSubEntityKeyFields()}},{key:"getSubEntityKeyFields",value:function(){var t=this,e={subEntityList:Object.keys(t.subEntityList).join(",")};this.callAPI("../aspx/EntityForm.aspx/GetSubEntityKeyFieldsWS",e,!0,function(e){if(e.success){var a=JSON.parse(e.response).d;t.subEntityKeyFields=JSON.parse(a),ShowHideDimmer(!1)}else ShowHideDimmer(!1)})}},{key:"populateEntityWiseFlds",value:function(t,e){_entityForm.entityWiseFields[e.ftransid]||(_entityForm.entityWiseFields[e.ftransid]={},_entityForm.entityWiseFields[e.ftransid].largeTextElements=[],_entityForm.entityWiseFields[e.ftransid].attachmentElements=[],_entityForm.entityWiseFields[e.ftransid].otherElements=[],_entityForm.entityWiseFields[e.ftransid].buttonElements=[]);var a=getFieldDataType(e).toUpperCase();"BUTTON"===a?_entityForm.entityWiseFields[e.ftransid].buttonElements.push(e):"ATTACHMENTS"===a?_entityForm.entityWiseFields[e.ftransid].attachmentElements.push(e):"LARGE TEXT"===a?_entityForm.entityWiseFields[e.ftransid].largeTextElements.push(e):_entityForm.entityWiseFields[e.ftransid].otherElements.push(e)}},{key:"constructEntityFormHTML",value:function(){var t=this.entityFormJson,e=document.getElementById("entityform-container");if(_entityCommon.inValid(t.error)){var a=this.groupByDC(t.data);this.parseFormMetaData(t.metadata),this.constructScriptButtons(t.metadata),e.innerHTML=this.generateHTML(a,t.metadata)}else e.innerHTML=t.error[0].msg}},{key:"parseFormMetaData",value:function(t){var e=this;t.forEach(function(t){e.flds[t.fname]=t})}},{key:"constructScriptButtons",value:function(t){var e="";t.filter(function(t){return"Button"==t.customdatatype}).forEach(function(t){e+='<div class="menu-item px-3 my-0" onclick="_entityForm.callScriptAction(\''.concat(t.fname,'\')">\n                        <a href="javascript:void(0)" class="menu-link px-3 py-2" data-kt-element="mode" data-target="lightTheme" data-kt-value="light">\n                            <span class="material-icons material-icons-style material-icons-2">keyboard_double_arrow_right</span>\n                            <span class="menu-title">').concat(t.caption,"\n                            </span>\n                        </a>\n                    </div>")}),e&&(document.querySelector("#scriptBtns-btn").classList.remove("d-none"),document.querySelector("#scriptBtns-container").innerHTML=e)}},{key:"callScriptAction",value:function(t){ShowHideDimmer(!0);var e={transId:this.entityTransId,script:t,recordId:this.recordId};this.callAPI("../aspx/EntityForm.aspx/CallScriptsWS",e,!0,function(e){if(ShowHideDimmer(!1),e.success)try{e=JSON.parse(JSON.parse(e.response).d).result,AssignLoadValues(e,"",t,"");try{AxAfterCallAction()}catch(a){}}catch(n){}else showAlertDialog("Error",e.response)})}},{key:"bindEvents",value:function(){var t=this,e=document.getElementById("Project_Entity_form");e.addEventListener("scroll",function(){if(t.isSubEntitiesAvailable&&t.activitiesExpanded&&isScrollAtBottomWithinDiv(e)){var a=t.maxPageNumber+1;t.getSubEntityListData(a)}}),t.bindThemeEvent()}},{key:"bindAccordionExpandEvent",value:function(){var t=this;document.querySelectorAll(".connecteddata-accordions").forEach(function(e){$(e).on("show.bs.collapse",function(){var e=this;setTimeout(function(){if(!e.classList.contains("data-fetched")){var a=e.dataset.transid;e.classList.add("data-fetched"),t.fetchConnectedDataRecords(a)}},1)})}),document.querySelectorAll(".right-connectedpagesdata").forEach(function(e){$(e).on("show.bs.collapse",function(){this.classList.contains("data-fetched")||(this.classList.add("data-fetched"),t.fetchAllConnectedDataMetrics())})}),document.querySelectorAll(".subentity-add").forEach(function(e){e.addEventListener("click",function(){var e=this.dataset.transid;return t.openSubEntityTstruct(e),!1})}),document.querySelectorAll(".subentity-list").forEach(function(e){e.addEventListener("click",function(){var e=this.dataset.transid;this.dataset.caption;return t.openEntityPage(e),!1})})}},{key:"getSubEntityConnectedDataFilter",value:function(){var t="";return Object.entries(this.subEntityMapping).forEach(function(e){var a=_slicedToArray(e,2),n=a[0],i=a[1],o=i.mapdatavalue,c=i.mapfield;t+="".concat(n,"~~~~").concat(i.mapfieldjson.normalized||"F","~").concat(i.mapfieldjson.srctable||"","~").concat(i.mapfieldjson.srcfield||"","~").concat(i.mapfieldjson.allowempty||"F","~").concat(i.mapfieldjson.tablename||"","~").concat(c,"~'").concat(o,"'^")}),t.endsWith("^")?t.substr(0,t.length-1):t}},{key:"getConnectedDataMetricsCriteria",value:function(t){var e=t+"~",a=this.connectedDataFields[t];if(_entityCommon.isValid(a)){a.forEach(function(t){e+="".concat(t.condition,"(").concat(t.fieldname,") ").concat(t.condition,"_").concat(t.fieldname,",")}),e.endsWith(",")&&(e=e.substr(0,e.length-1));var n=this.subEntityMapping[t],i=n.mapdatavalue,o=n.mapfield;e+="~".concat(n.mapfieldjson.normalized||"F","~").concat(n.mapfieldjson.srctable||"","~").concat(n.mapfieldjson.srcfield||"","~").concat(n.mapfieldjson.allowempty||"F","~").concat(n.mapfieldjson.tablename||"","~").concat(o,"~'").concat(i,"'^")}return e.endsWith("^")?e.substr(0,e.length-1):e}},{key:"getAllConnectedDataMetricsCriteria",value:function(){var t=this,e="";return Object.keys(t.connectedDataFields).forEach(function(a){e+=a+"~";var n=t.connectedDataFields[a];if(_entityCommon.isValid(n)){n.forEach(function(t){e+="".concat(t.condition,"(").concat(t.fieldname,") ").concat(t.condition,"_").concat(t.fieldname,",")}),e.endsWith(",")&&(e=e.substr(0,e.length-1));var i=t.subEntityMapping[a],o=i.mapdatavalue,c=i.mapfield;e+="~".concat(i.mapfieldjson.normalized||"F","~").concat(i.mapfieldjson.srctable||"","~").concat(i.mapfieldjson.srcfield||"","~").concat(i.mapfieldjson.allowempty||"F","~").concat(i.mapfieldjson.tablename||"","~").concat(c,"~'").concat(o,"'^")}}),e.endsWith("^")?e.substr(0,e.length-1):e}},{key:"getConnectedData",value:function(){var t=this,e=t.getSubEntityConnectedDataFilter(),a={entityName:t.entityName,transId:t.entityTransId,condition:"General",criteria:e,recordId:t.recordId,keyValue:t.keyValue};this.callAPI("../aspx/EntityForm.aspx/GetSubEntityChartsDataWS",a,!0,function(e){if(e.success){t.connectedDataJson=JSON.parse(JSON.parse(e.response).d);var a=t.connectedDataJson.result.charts;a.length?(t.isSubEntitiesAvailable=!0,t.isSubEntitiesAvailable=!0,t.constructConnectedDataAccordions(a)):t.isSubEntitiesAvailable=!1}})}},{key:"constructFormRelatedDataAccordions",value:function(){var t=this,e=[];if(""!=t.relatedDataFields){var a=[];t.relatedDataFields.split(",").forEach(function(t){a.push(t.split("~")[1])}),e=t.metaData.filter(function(t){return"F"===t.subentity&&"F"===t.hide&&a.includes(t.fldname)});var n="";e.forEach(function(e){var a=e.fldcap||"",i=t.entityFormJson.data.filter(function(t){return t.n===e.fldname});if(i.length){var o=1;i.forEach(function(t){a=ReverseCheckSpecialChars(t.v);var i="".concat(e.dcname).concat(o);n+='<div class="col-xl-12 col-lg-12 col-sm-12 Invoice-content-wrap rightpanel-relatedddata-accordion" data-fldid="'.concat(e.fldname,'" data-dcname="').concat(e.dcname,'" data-rowno="').concat(o,'"  data-fldval="').concat(a,'" data-griddc="').concat(e.griddc,'">\n                            <a href="#" class="Invoice-item accordion-header accordion-button fs-4 fw-semibold collapsed" data-bs-toggle="collapse" data-bs-target="#kt_accordion_connecteddata_').concat(i).concat(e.fldname,'" aria-expanded="false" aria-controls="kt_accordion_connecteddata_').concat(i).concat(e.fldname,'">\n                                <div class="Invoice-icon">\n                                    <span class="material-icons material-icons-style material-icons-2">account_tree</span>\n                                </div>\n                                <div class="Invoice-content">\n                                    <h6 class="subtitle">').concat(e.fldcap||""," - ").concat(a,'</h6>\n                                </div>\n                            </a>\n                            <div id="kt_accordion_connecteddata_').concat(i).concat(e.fldname,'" class="accordion-collapse collapse" aria-labelledby="kt_accordion_connecteddata_').concat(i).concat(e.fldname,'">\n                                <div class="cc-metrics-panel">\n                                    <div class="cc-metrics-list">               \n                                    </div>\n                                </div>\n                            </div>\n                        </div>'),o++})}}),n&&(document.querySelector("#KPI-2 .row").insertAdjacentHTML("afterbegin",n),document.querySelector("#KPI-2").classList.remove("d-none"),document.querySelector("#NO-KPI-Items").classList.add("d-none")),document.querySelectorAll(".rightpanel-relatedddata-accordion").forEach(function(e){$(e).on("show.bs.collapse",function(){if(!this.classList.contains("data-fetched")){var e=this.dataset.fldid,a=this.dataset.dcname,n=this.dataset.griddc,i=this.dataset.rowno,o=this.dataset.fldval;t.fetchFilteredData(e,o,a,n,i.toString())}})})}}},{key:"getEntityListDataForOtherData",value:function(t,e,a){ShowHideDimmer(!0);var n=this,i={transId:n.entityTransId,fields:n.fields,pageNo:t,pageSize:n.pageSize,filter:n.filter,gridDc:a};this.callAPI("../aspx/Entity.aspx/GetEntityListWithGridDataWS",i,!1,function(a){if(a.success){var i,o,c;ShowHideDimmer(!1);var r=JSON.parse(JSON.parse(a.response).d);r=null!==(i=null===(o=r.result.list)||void 0===o?void 0:null===(c=o[0])||void 0===c?void 0:c.data_json)&&void 0!==i?i:"[]";try{r.constructor!=Array&&(r=JSON.parse(r))}catch(s){return void showAlertDialog("error","Error occurred in data fetch.")}if(0==(r.length||0)){if(1==t)return n.listJson=[],void(document.querySelector("kt_accordion_connecteddata_".concat(e)).innerHTML=n.emptyRowsHtml)}else n.constructFormRelatedDataList(r,e)}else ShowHideDimmer(!1)})}},{key:"constructFormRelatedDataList",value:function(t,e){var a=this,n="";a.entityWiseFields[a.entityTransId]||$.each(a.metaData.filter(function(t){return t.ftransid===a.entityTransId}),function(t,e){a.populateEntityWiseFlds(t,e)});var i,o=_createForOfIteratorHelper(t);try{for(o.s();!(i=o.n()).done;){var c,r=i.value;if(r.recordid!=a.recordId){var s=a.entityKeyField;if(r.hasOwnProperty(s)||(s=a.getKeyField(r.transid).fldname,_entityCommon.inValid(r[s])&&(s=Object.keys(r)[4])),r.keycol=s,!r.keycol||_entityCommon.inValid(r[r.keycol])){for(var l=Object.keys(r),d=null,u=4;u<l.length;u++){var m=l[u];if(null!==r[m]&&r[m]!==undefined&&""!==r[m]){d=m;break}}r.keycol=d,s=d}var p=null===(c=r[s])||void 0===c?void 0:c.toString().replace("T00:00:00",""),f=r.entityname||a.entityName;n+='<div class="cc-metrics-panel">\n                    <div class="cc-metrics-list">\n                        <div class="cc-metrics-item">\n                            <div class="cc-metrics-label">\n                                <a ref="javascript:void(0)" class="Project_title" onclick="_entityForm.openEntityForm(\''.concat(f,"', '").concat(r.transid,"', '").concat(r.recordid,"','").concat(p,"')\">").concat(p,"</a>                        \n                                ").concat(generateRowElements(r,r.transid,"Other Data"),"\n                            </div>\n                        </div>\n                    </div>\n                 </div>")}}}catch(h){o.e(h)}finally{o.f()}n?$("#kt_accordion_connecteddata_".concat(e)).html(n):(n='<div class="cc-metrics-panel">\n                    <div class="cc-metrics-list">\n                        <div class="cc-metrics-item">\n                            <div class="cc-metrics-label">                        \n                                No related data found.\n                            </div>\n                        </div>\n                    </div>\n                </div>',$("#kt_accordion_connecteddata_".concat(e)).html(n)),$("#related-records-container_".concat(e)).addClass("data-fetched"),$('[data-toggle="tooltip"]').tooltip(),initReadMore(),KTMenu.init()}},{key:"constructConnectedDataListHTML",value:function(t){var e=this,a="";return t.forEach(function(t){var n=JSON.parse(t.data_json)[0];n.caption=e.subEntityList[n.transid],n.initial=e.getSubEntityInitials(n.caption),0!=n.totrec&&(a+=Handlebars.compile(e.connectedData.accordion)(n))}),a}},{key:"getSubEntityFilter",value:function(t){var e="",a=[],n=this.subEntityMapping[t],i=n.mapfieldjson,o=n.mapdatavalue,c=n.mapfield;return e+="".concat(t,"=All=").concat(i.tablename,".").concat(c,"~'").concat(o,"'~").concat(i.tablename,"~").concat(i.normalized,"~").concat(i.srctable,"~").concat(i.srcfield,"~").concat(i.allowempty,"++"),a.push(t),e.endsWith("++")&&(e=e.substr(0,e.length-2)),this.subEntityFilter=e,this.selectedSubEntities=a.join(","),!0}},{key:"fetchConnectedDataRecords",value:function(t){var e=this;if(e.getSubEntityFilter(t)){ShowHideDimmer(!0);var a={entityName:e.entityName,transId:e.entityTransId,recordId:e.recordId,fields:e.subEntityFilter,pageNo:1,pageSize:1e4,metaData:!1,subEntityList:e.selectedSubEntities};e.callAPI("../aspx/EntityForm.aspx/GetSubEntityListDataWS",a,!1,function(a){if(ShowHideDimmer(!1),a.success){var n,i=JSON.parse(JSON.parse(a.response).d);i=null!==(n=i.result.list)&&void 0!==n?n:[];try{i.constructor!=Array&&(i=JSON.parse(i))}catch(r){return void showAlertDialog("error","Error occurred in data fetch.")}if(0==(i.length||0))return e.listJson=[],void showAlertDialog("warning","No records available.");try{var o;e.listJson=[],e.entityWiseFields={};var c=[];i.forEach(function(t){c.push(t.data_json)}),(o=e.listJson).push.apply(o,c),e.maxPageNumber=getMaxPageNumber(e.listJson),noMoreRecordsMessage.style.display="none",e.renderConnectedData(e.listJson,t)}catch(s){$("#sub-entitycontainer-".concat(t," .body_Container")).append(JSON.parse(a.response).d)}}})}}},{key:"fetchConnectedDataMetrics",value:function(t){var e=this,a=e.getConnectedDataMetricsCriteria(t);ShowHideDimmer(!0);var n={transId:t,recordId:e.recordId,criteria:a};e.callAPI("../aspx/EntityForm.aspx/GetEntityFormConnectedDataMetricsWS",n,!1,function(a){if(ShowHideDimmer(!1),a.success){var n,i=JSON.parse(JSON.parse(a.response).d);i=null!==(n=i.result.data)&&void 0!==n?n:[];try{i.constructor!=Array&&(i=JSON.parse(i))}catch(r){return void showAlertDialog("error","Error occurred in connected data fetch.")}if(0==(i.length||0))return void $("#kt_accordion_connecteddata_".concat(t," .cc-metrics-list")).html('<div class="cc-metrics-item">\n                            <div class="cc-metrics-label">                        \n                                No data found\n                            </div>\n                        </div>');try{var o=JSON.parse(i[0].data_json),c="";o.length>0&&(Object.keys(o[0]).forEach(function(t){if(-1==["cnd","condition","criteria","transid"].indexOf(t)){var a,n=o[0].transid,i=t.substr(4),r=(null===(a=e.metaData.find(function(t){return t.ftransid==n&&t.fldname==i}))||void 0===a?void 0:a.fldcap)||i,s=t.substr(0,3).replace("sum","Sum").replace("avg","Avg");c+='<div class="cc-metrics-item">\n                                            <div class="cc-metrics-label">                        \n                                                '.concat(r," (").concat(s,')\n                                            </div>\n                                            <div class="cc-metrics-value">').concat(o[0][t],"</div>\n                                        </div>")}}),$("#kt_accordion_connecteddata_".concat(t," .cc-metrics-list")).html(c))}catch(s){console.log("Error"+s)}}})}},{key:"fetchAllConnectedDataMetrics",value:function(){var t=this,e=t.getAllConnectedDataMetricsCriteria();ShowHideDimmer(!0);var a={transId:t.entityTransId,recordId:t.recordId,criteria:e};t.callAPI("../aspx/EntityForm.aspx/GetEntityFormConnectedDataMetricsWS",a,!1,function(e){if(ShowHideDimmer(!1),e.success){var a,n=JSON.parse(JSON.parse(e.response).d);n=null!==(a=n.result.data)&&void 0!==a?a:[];try{n.constructor!=Array&&(n=JSON.parse(n))}catch(o){return void showAlertDialog("error","Error occurred in connected data fetch.")}if(0==(n.length||0))return void $("#kt_accordion_connecteddata_".concat(transId," .cc-metrics-list")).html('<div class="cc-metrics-item">\n                            <div class="cc-metrics-label">                        \n                                No data found\n                            </div>\n                        </div>');try{var i="";n.forEach(function(e){var a=JSON.parse(e.data_json);a.length>0&&(i+='<div class="cc-metrics-item cc-metrics-caption">\n                                                <div class="cc-metrics-label">\n                                                    '.concat(t.subEntityList[a[0].transid],"\n                                                </div>\n                                            </div>"),Object.keys(a[0]).forEach(function(e){if(-1==["cnd","condition","criteria","transid"].indexOf(e)){var n,o=a[0].transid,c=e.substr(4),r=(null===(n=t.metaData.find(function(t){return t.ftransid==o&&t.fldname==c}))||void 0===n?void 0:n.fldcap)||c,s=e.substr(0,3).replace("sum","Sum").replace("avg","Avg");i+='<div class="cc-metrics-item">\n                                                <div class="cc-metrics-label">                        \n                                                    '.concat(r," (").concat(s,')\n                                                </div>\n                                                <div class="cc-metrics-value">').concat(a[0][e],"</div>\n                                            </div>")}}))}),$("#kt_accordion_connectedpagesdata .cc-metrics-list").html(i)}catch(c){console.log("Error"+c)}}})}},{key:"bindThemeEvent",value:function(){var t=this;document.querySelectorAll("#selectThemes .menu-link").forEach(function(e){e.addEventListener("click",function(a){a.preventDefault();var n=this.getAttribute("data-target");t.updateActiveClass(e);var i={page:"ENTITY_FORM",transId:t.entityTransId,properties:{THEME:n},confirmNeeded:!0,allUsers:!0};_entityCommon.setAnalyticsDataWS(i,function(){t.updateTheme(n)},function(t){console.error("Error in SetAnalyticsDataWS:",t),ShowHideDimmer(!1)})})})}},{key:"applyTheme",value:function(){var t=this.properties.THEME||"gradTheme";this.updateTheme(t);var e=document.querySelector('#selectThemes .menu-link[data-target="'.concat(t,'"]'));e&&this.updateActiveClass(e)}},{key:"updateActiveClass",value:function(t){document.querySelectorAll("#selectThemes .menu-link").forEach(function(t){t.classList.remove("active")}),t.classList.add("active")}},{key:"updateTheme",value:function(t){var e=document.body;e.classList.remove("lightTheme","blackTheme","gradTheme","compactTheme"),"lightTheme"===t||"light"===t?e.classList.add("lightTheme"):"blackTheme"===t||"dark"===t?e.classList.add("blackTheme"):"gradTheme"===t||"gradient"===t||"system"===t?e.classList.add("gradTheme"):"compactTheme"!==t&&"pattern"!==t||e.classList.add("compactTheme")}},{key:"createHTML",value:function(t,e){var a=this,n="",i=t[0].n.toLowerCase();if(t[0].hasdatarows&&"yes"===t[0].hasdatarows){var o={};t.forEach(function(t){if("dc"!==t.t){var e=t.r;o[e]||(o[e]=[]),o[e].push(t)}});var c={};t.forEach(function(t){"dc"!==t.t&&(c[t.r]||(c[t.r]={}),c[t.r][t.n]=t.v)}),n+='<div class="row" style="position: relative; right: 3px;" id="'.concat(i,'">\n                        <div class="dc-heading card-title cursor-pointer collapsible rotate collapsed" data-bs-toggle="collapse"\n                            aria-expanded="true" data-bs-target="#').concat(i,'container" >\n                            <span class="material-icons material-icons-style material-icons-2 rotate-180">expand_circle_down</span>\n                            ').concat(getCaption(i),'\n                        </div>\n        \n                        <div id="').concat(i,'container" class="row sub-entity-row collapse">\n                            <div class="table-responsive">\n                                <table class="table table-light table-striped table-bordered tabularDC">'),n+="<thead><tr>";var r=e.filter(function(t){return"dc"!=t.datatype&&t.dcname==i&&null!=t.hidden&&"T"!=t.hidden});r.forEach(function(t){n+="<th>".concat(t.caption,"</th>")}),n+="</tr></thead>",n+="<tbody>",Object.keys(c).forEach(function(t){n+="<tr>",r.forEach(function(e,i){var o=c[t][e.fname]||"",r="";if("Currency"===e.customdatatype)r=_entityCommon.inValid(o)?"--":formmatingtoillions(o);else if("Numeric"===e.customdatatype)r=_entityCommon.inValid(o)?"--":o;else if(e.fname.startsWith("axpfile_")){var s=_entityForm.entityFormJson.data.find(function(t){return t.n===e.fname.replace("axpfile_","axpfilepath_")}),l=s?s.v:"";-1!=l.indexOf(";bkslh")&&(l=l.replace(new RegExp(";bkslh","g"),"\\")),l.endsWith("\\")&&(l=l.substr(0,l.length-1)),(d={}).v=ReverseCheckSpecialChars(o),d.filepath=l,r=a.createAxpFileAttachmentHTML(d,i,e.fname)}else if(e.fname.startsWith("dc")&&e.fname.endsWith("_image")){var d;(d={}).v=ReverseCheckSpecialChars(o),r=a.createDCAttachmentHTML(d,i,"")}else r=ReverseCheckSpecialChars(o);var u="Currency"===e.customdatatype||"Numeric"===e.customdatatype;n+="<td".concat(u?' class="align-right"':"",">").concat(r,"</td>")}),n+="</tr>"}),n+="</tbody>",n+="</table></div></div></div>"}else{var s=1,l=0,d="";d="dc1"==i?'<div class="row" style="position: relative; right: 3px;" id="'.concat(i,'">\n                            <div class="dc-heading card-title cursor-pointer collapsible rotate" data-bs-toggle="collapse"\n                                aria-expanded="true" data-bs-target="#').concat(i,'container" >\n                                <span class="material-icons material-icons-style material-icons-2 rotate-180">expand_circle_down</span>\n                                ').concat(getCaption(i),'\n                            </div>\n                            <div id="').concat(i,'container" class="row sub-entity-row collapse show">'):'<div class="row" style="position: relative; right: 3px;" id="'.concat(i,'">\n                            <div class="dc-heading card-title cursor-pointer collapsible rotate collapsed" data-bs-toggle="collapse"\n                                aria-expanded="true" data-bs-target="#').concat(i,'container" >\n                                <span class="material-icons material-icons-style material-icons-2 rotate-180">expand_circle_down</span>\n                                ').concat(getCaption(i),'\n                            </div>\n                            <div id="').concat(i,'container" class="row sub-entity-row collapse">'),t.forEach(function(t){if(t.n){var n=getHiddenFlag(t.n);null!=n&&"T"!=n&&(l++,d+=a.nongridDcHTML(t,s,e))}s++}),d+="</div></div>",l>0&&(n+=d)}return n}},{key:"groupByDC",value:function(t){var e=this,a=[],n=[],i=!1;return t.forEach(function(t){var o,c;"dc"===t.t&&(i=!1,t.n&&e.hideControls.indexOf(null===(c=t.n)||void 0===c?void 0:c.toLowerCase())>-1&&(i=!0),n.length>0&&a.push(n),n=[]);i||!t.n||e.hideControls.indexOf(null===(o=t.n)||void 0===o?void 0:o.toLowerCase())>-1||n.push(t)}),n.length>0&&a.push(n),a}},{key:"generateHTML",value:function(t,e){var a=this,n="";return t.forEach(function(t){n+=a.createHTML(t,e)}),n}},{key:"nongridDcHTML",value:function(t,e,a){var n=t.n,i=ReverseCheckSpecialChars(t.v),o=getCaption(t.n),c="",r=t.t.toUpperCase(),s="";if(this.flds&&this.flds[n]&&("Currency"===this.flds[n].customdatatype||"Numeric"===this.flds[n].customdatatype)&&(s=" align-right"),"DC"!=r){var l,d=(null===(l=this.components[r])||void 0===l?void 0:l.html)||'<div class="inputcontent" readonly>{{v}}</div>';if(""!=i){var u=this.getclassname(i,"");if(u.startsWith("col"))"";else{u=""}}if("RT"==r||"LT"==r)c=this.createRichTextComponent(t,e);else if("ATT"==r||n.startsWith("axpfile_")){var m,p=_entityForm.entityFormJson.data.find(function(t){return t.n===n.replace("axpfile_","axpfilepath_")}),f=p?p.v:"";-1!=(null===(m=f)||void 0===m?void 0:m.indexOf(";bkslh"))&&(f=f.replace(new RegExp(";bkslh","g"),"\\")),f.endsWith("\\")&&(f=f.substr(0,f.length-1)),f=f.replace(new RegExp("\\\\","g"),"\\\\"),t.filepath=f,c='<div class="'.concat(u," col-sm-12").concat(s,'" data-type="').concat(r,'" data-name="').concat(n,'" data-ctype="').concat(this.flds[n].customdatatype,'">\n                                <label>').concat(o,"</label>\n                                ").concat(this.createAttachmentHTML(t,e,u),"\n                            </div>")}else if(n.startsWith("dc")&&n.endsWith("_image"))c='<div class="'.concat(u," col-sm-12").concat(s,'" data-type="').concat(r,'" data-name="').concat(n,'" data-ctype="').concat(this.flds[n].customdatatype,'">\n                                <label>').concat(o,"</label>\n                                ").concat(this.createDCAttachmentHTML(t,e,u),"\n                            </div>");else if("Image"==this.flds[n].customdatatype)_entityCommon.isValid(t.v)&&(c='<div class="'.concat(u," col-sm-12").concat(s,'" data-type="').concat(r,'" data-name="').concat(n,'" data-ctype="').concat(this.flds[n].customdatatype,'">\n                                <label>').concat(o,"</label>\n                                ").concat(this.getTstructImage(t,e,u),"\n                            </div>"));else if("Check box"==this.flds[n].customdatatype){var h="T"===i?"checked":"";d=this.components.togglebutton.html.replace("{{checked}}",h),c='<div class="col-xl-3 col-lg-4 Eform_Display_Items col-sm-12" data-type="'.concat(r,'" data-name="').concat(n,'" data-ctype="').concat(this.flds[n].customdatatype,'">\n                                <label>').concat(o,"</label>\n                                ").concat(d,"\n                            </div>")}else"Currency"===this.flds[n].customdatatype&&(i=_entityCommon.inValid(i)?"--":formmatingtoillions(i)),d='<div class="inputcontent" readonly>'.concat(i,"</div>"),c='<div class="'.concat(u," col-sm-12").concat(s,'" data-type="').concat(r,'" data-name="').concat(n,'" data-ctype="').concat(this.flds[n].customdatatype,'">\n                                <label>').concat(o,"</label>\n                                ").concat(d,"\n                            </div>")}return t.v&&(t.v=_entityCommon.replaceSpecialChars(t.v)),Handlebars.compile(c)(t)}},{key:"ConstructEntityForm",value:function(t,e){var a=document.querySelector(t);a.className="container";var n=!1,i=null;(s=document.createElement("div")).classList.add("row");for(var o=[],c=0;c<e.length;c++){if("DC"==e[c].props.split("~")[0]){var r=e[c].dcno;if(i!==r){var s;n=!1,""!==s.innerHTML&&(a.appendChild(s.cloneNode(!0)),s.innerHTML=""),(s=document.createElement("div")).classList.add("row"),s.style.position="relative",s.style.right="3px";var l=document.createElement("div");l.className="dc-heading",l.innerHTML="<h3>"+e[c].caption+"</h3>",s.appendChild(l),a.appendChild(s),i=r,this.isGridDC(e[c])&&(n=!0,o=[])}}if(n){if("DC"!==e[c].props.split("~")[0]&&this.fldtype.includes(e[c].props.split("~")[0])&&"F"!==e[c].props.split("~")[2]&&(o.push(e[c]),(c+1===e.length||"DC"===e[c+1].props.split("~")[0])&&o.length>0)){var d=this.gridDc(o,c);s.innerHTML+=d,o=[]}}else if("DC"!==e[c].props.split("~")[0]&&this.fldtype.includes(e[c].props.split("~")[0])&&"F"!==e[c].props.split("~")[2]){var u=this.nongridDc(e[c],c);s.innerHTML+=u}}""!==s.innerHTML&&a.appendChild(s)}},{key:"isGridDC",value:function(t){return"T"==t.props.split("~")[1]}},{key:"gridDc",value:function(t,e){var a={};t.forEach(function(t){var n,i=t.fieldid,o=t.value;a[i]||(a[i]=[]);var c=t.row-1;a[i][c]||(a[i][c]="");var r=t.props.split("~")[0],s=(null===(n=_entityForm.components[t.props.split("~")[0]])||void 0===n?void 0:n.html)||'<div class="inputcontent"  readonly>{{v}}</div>';if("ATT"==r||fldName.startsWith("axpfile_")||fldName.startsWith("dc")&&fldName.endsWith("_image")){var l=_entityForm.getclassname(t.value,t.props.split("~")[3]),d=_entityForm.entityFormJson.data.find(function(t){return t.n===fldName.replace("axpfile_","axpfilepath_")}),u=d?d.v:"";-1!=u.indexOf(";bkslh")&&(u=u.replace(new RegExp(";bkslh","g"),"\\")),u.endsWith("\\")&&(u=u.substr(0,u.length-1)),u=u.replace(new RegExp("\\\\","g"),"\\\\"),fldjson.filepath=u,s='<div class="'.concat(l,' col-sm-12 " data-type="').concat(fieldType,'" data-name="').concat(fldName,'" data-ctype="').concat(this.flds[fldName].customdatatype,'"><label>').concat(fldCaption,"</label>").concat(this.createAttachmentHTML(fldjson,e,l),"</div>"),a[i][c]+=s+"<br>"}else if("togglebutton"==r&&_entityForm.fldtype.includes(t.props.split("~")[0])){var m,p=(null===(m=_entityForm.components[r])||void 0===m?void 0:m.html)||'<div class="inputcontent"  readonly>{{v}}</div>',f="T"===t.value?"checked":"";p=p.replace("{{checked}}",f),s='<div class="'.concat(l,' col-sm-12" style="display:inline-grid;" ><div><label style="font-weight:bold;">').concat(t.caption,"</label></div><div>").concat(p,"</div></div>"),a[i][c]+=s+"<br>"}else a[i][c]+=o+"<br>"});var n='<table class="table table-light table-striped table-bordered">';n+="<thead><tr>",Object.keys(a).forEach(function(t){n+="<th>"+t+"</th>"}),n+="</tr></thead><tbody>";for(var i=Math.max.apply(Math,_toConsumableArray(Object.values(a).map(function(t){return t.length}))),o=0;o<i;o++)n+="<tr>",Object.keys(a).forEach(function(t){var e=a[t][o]||"";n+="<td>"+e+"</td>"}),n+="</tr>";return n+="</tbody></table>"}},{key:"nongridDc",value:function(t,e){var a,n="",i=t.props.split("~")[0],o=(null===(a=this.components[i])||void 0===a?void 0:a.html)||'<div class="inputcontent"  readonly>{{v}}</div>';if(""!=t.value){var c=this.getclassname(t.value,t.props.split("~")[3]);if(c.startsWith("col"))r="";else{var r=c;c=""}}if("RT"==i||"LT"==i)n=this.createRichTextComponent(t,e);else if("ATT"==i)n=this.createAttachmentHTML(t,e,c);else if("Img"==i)n=this.getimage(t,e,c);else if("togglebutton"==i){var s="T"===t.value?"checked":"";o=o.replace("{{checked}}",s),n='<div class="'.concat(c,' col-sm-12 " style="display:inline-grid;" ><div><label style="font-weight:bold;">').concat(t.caption,"</label></div><div>").concat(o,"</div></div>")}else n='<div class="'.concat(c,' col-sm-12 " style="width:').concat(r,'px;"><div><label style="font-weight:bold;">{{caption}}</label></div><div>').concat(o,"</div></div>");return t.v&&(t.v=_entityCommon.replaceSpecialChars(t.v)),Handlebars.compile(n)(t)}},{key:"getimage",value:function(t,e,a){var n,i=this.downloadFileAttachment(t.caption,""),o=t.props.split("~")[0],c=(null===(n=this.components[o])||void 0===n?void 0:n.html)||'<div class="inputcontent"  readonly>{{v}}</div>';return c=c.replace("{{colclassname}}","".concat(a)),c=i!=undefined?c.replace("{{src}}","".concat(i)):c.replace("{{src}}","../images/logo.png"),'<div class="'.concat(a,' col-sm-12 ">').concat(c,"</div>")}},{key:"getTstructImage",value:function(t,e,a){var n,i,o=ReverseCheckSpecialChars(t.v),c="";o.length>1&&(c=this.getScriptsPath()+"/"+o),GetDateTime(),i=c+"?"+imageSuffix;var r=(null===(n=this.components.Image)||void 0===n?void 0:n.html)||'<div class="inputcontent"  readonly>{{v}}</div>';return r=r.replace("{{colclassname}}","".concat(a)),i!=undefined&&(r=r.replace("{{src}}","".concat(i))),r}},{key:"getScriptsPath",value:function(){var t="",e=$j("#hdnScriptsUrlpath");return e[0]!=undefined&&(t=e.val()+"axpert/"+callParentNew("mainSessionId")),t}},{key:"createRichTextComponent",value:function(t,e){var a='<div class="col-lg-12 col-sm-12 ">\n                        <div class="mb-3">\n                            <label style="font-weight:bold;">{{caption}}</label>\n                        </div>\n                        <div id=\'textcontent'.concat(e,'\' class="mb-5">').concat(t.value,"</div>\n                    </div>");return t.v&&(t.v=_entityCommon.replaceSpecialChars(t.v)),a=Handlebars.compile(a)(t)}},{key:"createAttachmentHTML",value:function(t,e,a){var n=this;if(t.v){var i,o=(null===(i=this.components.ATT)||void 0===i?void 0:i.html)||'<div class="inputcontent" readonly>{{v}}</div>',c=t.v.split(",").map(function(t){return t.trim()}).filter(function(t){return t}),r="";return c.forEach(function(a,i){var c=ReverseCheckSpecialChars(a).split(".").pop().toLowerCase(),s=n.getFileImgHTML(c),l=o.replaceAll("{{customid}}","fileattached".concat(e,"_").concat(i)).replace("{{componentimg}}",s),d=_objectSpread(_objectSpread({},t),{},{v:_entityCommon.replaceSpecialChars(a)});r+=Handlebars.compile(l)(d)}),r}return""}},{key:"createAxpFileAttachmentHTML",value:function(t,e,a){var n=this;if(t.v){GetFieldsName(a);var i,o=(null===(i=this.components.AXPFILE_ATT)||void 0===i?void 0:i.html)||'<div class="inputcontent" readonly>{{v}}</div>',c=t.v.split(",").map(function(t){return t.trim()}).filter(function(t){return t}),r="";return c.forEach(function(i,c){var s=ReverseCheckSpecialChars(i).split(".").pop().toLowerCase(),l=n.getFileImgHTML(s),d=o.replaceAll("{{customid}}","fileattached".concat(e,"_").concat(c)).replace("{{componentimg}}",l),u=_objectSpread(_objectSpread({},t),{},{v:_entityCommon.replaceSpecialChars(i),scriptspath:window.parent.mainRestDllPath,sid:window.parent.mainSessionId,fieldid:a});r+=Handlebars.compile(d)(u)}),r}return""}},{key:"createDCAttachmentHTML",value:function(t,e,a){var n=this;if(t.v){var i,o=(null===(i=this.components.GRID_ATT)||void 0===i?void 0:i.html)||'<div class="inputcontent" readonly>{{v}}</div>',c=t.v.split(",").map(function(t){return t.trim()}).filter(function(t){return t}),r="";return c.forEach(function(a,i){var c=ReverseCheckSpecialChars(a).split(".").pop().toLowerCase(),s=n.getFileImgHTML(c),l=o.replaceAll("{{customid}}","fileattached".concat(e,"_").concat(i)).replace("{{componentimg}}",s),d=_objectSpread(_objectSpread({},t),{},{v:_entityCommon.replaceSpecialChars(a)});r+=Handlebars.compile(l)(d)}),r}return""}},{key:"getclassname",value:function(t,e){return""==e||e==undefined||null==e?t.length>50?"col-xl-12 col-lg-12 Eform_Display_Items":t.length>30?"col-xl-6 col-lg-8 Eform_Display_Items":"col-xl-3 col-lg-4 Eform_Display_Items":e}},{key:"downloadFileAttachment",value:function(t,e){var a=this.getScriptsPath()+"/"+t;ASB.WebService.LoadAxpFileToScript(e,t,function(){var t=(a=unescape(a)).lastIndexOf("/");t>-1&&(a=a.substring(0,t+1)+encodeURIComponent(a.substring(t+1,a.length)));if(isMobile){var e=a.match(/\/([^\/?#]+)$/)[1];OpenPdfFile(e,"","","",!1)}else window.open(a,"GridUploadFile","width=500,height=350,scrollbars=no,resizable=yes")})}},{key:"downloadAxpFileAttachment",value:function(t,e,a,n,i){n.stopPropagation(),e=e.replace(//g,"'"),a=a.replace(//g,"'");t.substr(7);var o=$(i).data("filepath");ASB.WebService.LoadAxpFileToScript(o,e,function(){var t=(a=unescape(a)).lastIndexOf("/");t>-1&&(a=a.substring(0,t+1)+encodeURIComponent(a.substring(t+1,a.length)));if(isMobile){var e=a.match(/\/([^\/?#]+)$/)[1];OpenPdfFile(e,"","","",!1)}else window.open(a,"GridUploadFile","width=500,height=350,scrollbars=no,resizable=yes")})}},{key:"showGridAttLink",value:function(t){var e=this.getScriptsPath()+"/"+t;e=e.replace(//g,"'");var a=(e=unescape(e)).lastIndexOf("/");a>-1&&(e=e.substring(0,a+1)+encodeURIComponent(e.substring(a+1,e.length))),window.open(e,"GridUploadFile","width=500,height=350,scrollbars=no,resizable=yes")}},{key:"downloadAttachment",value:function(t,e,a){var n=document.createElement("a");n.style.display="none",document.body.appendChild(n),n.href=t,n.download=e,n.click(),document.body.removeChild(n)}},{key:"getFileImgHTML",value:function(t){switch(t){case"pdf":return'<img src="../Images/filetypes/pdf.svg" class="file-img"/>';case"ppt":case"pptx":return'<img src="../Images/filetypes/ppt.svg" class="file-img"/>';case"jpeg":case"jpg":case"png":return'<img src="../Images/filetypes/images.svg" class="file-img" />';case"doc":case"docx":return'<img src="../Images/filetypes/word.svg" class="file-img" />';case"txt":return'<img src="../Images/filetypes/text.svg" class="file-img" />';case"xls":case"xlsx":case"csv":return'<img src="../Images/filetypes/csv.svg" class="file-img"/>';default:return'<img src="../Images/filetypes/default.svg" class="file-img" />'}}},{key:"addmore",value:function(){document.querySelectorAll("[id^=".concat("textcontent","]")).forEach(function(t){var e=$(t).html();if(e.length>350){var a=e.substr(0,350),n=e.substr(350);$(t).html(a),$(t).append('<span class="more-text" style="display:none;">'+n+"</span>"),$(t).append('<a href="#" class="read-more">..Read More</a>')}$(t).on("click",".read-more",function(t){t.preventDefault(),"..Read More"===$(this).text()?($(this).text("Show Less"),$(this).prev(".more-text").show()):($(this).text("..Read More"),$(this).prev(".more-text").hide())})})}},{key:"readmore",value:function(){document.querySelectorAll("[id^=".concat("textcontent","]")).forEach(function(t){var e=t.innerHTML.trim().split("\n"),a=e.slice(0,2),n=a.join("\n"),i=document.createElement("div");i.innerHTML=n,document.body.appendChild(i);i.clientHeight;i.parentNode.removeChild(i);var o=e.slice(2).join("\n");a.length>=2?(t.innerHTML=n,t.insertAdjacentHTML("beforeend",'<span class="more-text" style="display:none;">'+o+"</span>"),t.insertAdjacentHTML("beforeend",'<a href="#" class="read-more" style="float:right;">..Read More</a>')):(t.innerHTML=n,t.insertAdjacentHTML("beforeend",'<span class="more-text" style="display:none;">'+o+"</span>"),t.insertAdjacentHTML("beforeend",'<a href="#" class="read-more" style="float:right;display:none;">..Read More</a>')),t.addEventListener("click",function(t){t.target.matches(".read-more")&&(t.preventDefault(),"..Read More"===t.target.textContent?(t.target.textContent="Read Less",t.target.previousElementSibling.style.display="inline"):(t.target.textContent="..Read More",t.target.previousElementSibling.style.display="none"))})})}},{key:"callAPI",value:function(t,e,a,n){var i=this,o=new XMLHttpRequest;o.open("POST",t,a),o.setRequestHeader("Content-Type","application/json;charset=UTF-8"),o.onreadystatechange=function(){4==this.readyState&&(200==this.status?n({success:!0,response:this.responseText}):(i.catchError(this.responseText),n({success:!1,response:this.responseText})))},o.send(JSON.stringify(e))}},{key:"setSelectedRelatedFields",value:function(){var t={transId:this.entityTransId,fields:this.relatedDataFields};this.callAPI("../aspx/EntityForm.aspx/SetSelectedRelatedDataFieldsWS",t,!0,function(t){t.success?(_entityForm.reloadEntityPage(),ShowHideDimmer(!1)):ShowHideDimmer(!1)})}},{key:"setSelectedDisplayFields",value:function(){var t={transId:this.entityTransId,fields:this.relatedDataDisplayFields,gridFields:this.relatedDataDisplayGridFields};this.callAPI("../aspx/EntityForm.aspx/SetSelectedDisplayFieldsWS",t,!0,function(t){t.success?(_entityForm.reloadEntityPage(),ShowHideDimmer(!1)):ShowHideDimmer(!1)})}},{key:"getSubEntityInitials",value:function(t){var e="",a=t.split(" ");return 1===a.length?e=1==a[0].length?a[0].charAt(0):a[0].charAt(0)+a[0].charAt(1):2===a.length?e=a[0].charAt(0)+a[1].charAt(0):a.length>=3&&(e=a[0].charAt(0)+a[1].charAt(0)),e.toUpperCase()}},{key:"renderConnectedData",value:function(t,e){var a=this,n="",i=t;Object.keys(a.subEntityMapping).forEach(function(t){a.entityWiseFields[t]||$.each(a.metaData.filter(function(e){return e.ftransid===t}),function(t,e){a.populateEntityWiseFlds(t,e)})});var o=!1;try{o=AxRenderConnectedDataCustom(a,t,e)}catch(m){o=!1}if(!o){if(0===i.length)return n+="<p>No records found.</p>",void $("#sub-entitycontainer-".concat(e," .body_Container")).append(n);n+='<div style="overflow-x: auto; max-width: 100%; white-space: nowrap;">',n+='<table id="subEntityTable_'.concat(e,'" class="table table-striped table-bordered">');var c=i[0],r=Object.keys(c).filter(function(t){return!["projectid","axpeg_processname","axpeg_keyvalue","axpeg_status","axpeg_statustext","rno","pageno","transid","recordid","modifiedby","modifiedon","createdon","createdby"].includes(t)});n+="<thead><tr>",n+="<th>Actions</th>";var s=[];r.forEach(function(t){var i;if(void 0===(null===(i=a.entityWiseMetaData[e])||void 0===i?void 0:i[t]))s.push(t);else{var o,c,r=(null===(o=a.entityWiseMetaData[e])||void 0===o?void 0:null===(c=o[t])||void 0===c?void 0:c.fldcap)||t;n+="<th>".concat(r,"</th>")}}),n+="</tr></thead>",n+="<tbody>";var l,d=_createForOfIteratorHelper(i);try{var u=function(){var t=l.value,i=a.subEntityMapping[t.transid].keycol;t.hasOwnProperty(i)||(i=a.getKeyField(t.transid).fldname,_entityCommon.inValid(t[i])&&(i=Object.keys(t)[4]),a.subEntityMapping[t.transid].keycol=i),t.keycol=i;var o=t[i],c=a.subEntityList[t.transid];a.getSubEntityInitials(c);n+="<tr>",n+='<td style="display: flex; justify-content: center; gap: 10px;">',n+='<button type="button" class="btn btn-icon btn-white btn-color-gray-600 btn-active-primary shadow-sm tb-btn btn-sm" \n                        data-bs-toggle="tooltip" title="View" \n                        onclick="_entityForm.openEntityForm(\''.concat(a.subEntityList[t.transid],"', '").concat(t.transid,"', '").concat(t.recordid,"', '").concat(o,"', ").concat(t.rno,')">\n                        <span class="material-icons" style="color:red;">visibility</span>\n                     </button>'),n+='<button type="button" class="btn btn-icon btn-white btn-color-gray-600 btn-active-primary shadow-sm tb-btn btn-sm" \n                        data-bs-toggle="tooltip" title="Edit" \n                        onclick="_entityForm.editSubEntity(\''.concat(t.transid,"','").concat(t.recordid,'\'); return false;">\n                        <span class="material-icons material-icons-style material-icons-2" style="color:red;">edit_note</span>\n                     </button>'),n+="</td>",r.forEach(function(i){if(-1==s.indexOf(i)){var o,c=null!=t[i]?t[i]:"",r=null===(o=a.entityWiseMetaData[e])||void 0===o?void 0:o[i],l=!isNaN(parseFloat(c))&&isFinite(c),d="Currency"===(null==r?void 0:r.cdatatype),u="Date"===(null==r?void 0:r.cdatatype);d?c=_entityCommon.inValid(c)?"--":formmatingtoillions(c):u&&(c=formatDateString(c)),n+='<td class="'.concat(l||d?"align-right":"",'">').concat(c,"</td>")}}),n+="</tr>"};for(d.s();!(l=d.n()).done;)u()}catch(p){d.e(p)}finally{d.f()}n+="</tbody></table>",n+="</div>",$("#sub-entitycontainer-".concat(e," .body_Container")).append(n),setTimeout(function(){$("#subEntityTable_".concat(e)).DataTable({paging:!0,searching:!0,info:!1,scrollX:!0,columnDefs:[{targets:"_all",className:"dt-center"}]})},0),initReadMore(),KTMenu.init(),$('[data-toggle="tooltip"]').tooltip()}}},{key:"constructConnectedDataAccordions",value:function(t){var e=this,a="";t.forEach(function(t){var n=JSON.parse(t.data_json)[0];if(0!=n.totrec){var i=e.subEntityList[n.transid];a+=Handlebars.compile(e.connectedData.accordionWrapper)({caption:i,transid:n.transid,totrec:n.totrec})}}),a&&(document.querySelector("#KPI-2").classList.remove("d-none"),document.querySelector("#NO-KPI-Items").classList.add("d-none"),document.querySelector("#entityform-container").insertAdjacentHTML("beforeend",a)),e.bindAccordionExpandEvent()}},{key:"constructCustomHyperLinkAccordions",value:function(){var t="";document.querySelector("#KPI-2").classList.remove("d-none"),document.querySelector("#NO-KPI-Items").classList.add("d-none"),document.querySelector(".right-customhyperlinks").classList.remove("d-none"),this.customHyperLinks.forEach(function(e){t+='<div class="cc-metrics-item">\n                    <div class="cc-metrics-label">                        \n                        <a href="javascript:void(0)" onclick="_entityCommon.navigateToUrl(\''.concat(e.link,"')\">").concat(e.hyperlinkcaption,"</a>\n                    </div>\n                </div>")}),$("#kt_accordion_connecteddata_hyperlinks .cc-metrics-list").append(t)}},{key:"constructCustomDataSourceAccordion",value:function(){var t={name:"cdp_"+this.entityTransId,sqlParams:{}};_entityCommon.getDataFromDataSource(t,function(t){var e=JSON.parse(JSON.parse(t).result.data[0].data_json);if(e.length>0){var a="";document.querySelector("#KPI-2").classList.remove("d-none"),document.querySelector("#NO-KPI-Items").classList.add("d-none"),document.querySelector(".right-customdatasource").classList.remove("d-none"),e.forEach(function(t){a+='<div class="cc-metrics-item">\n                        <div class="cc-metrics-label">\n                            '.concat(t.name,'\n                        </div>\n                        <div class="cc-metrics-value">\n                            <a href="javascript:void(0)" onclick="_entityForm.navigateToUrl(\'').concat(t.link,"')\">").concat(t.value,"</a>\n                        </div>\n                     </div>")}),$("#kt_accordion_connecteddata_datasource .cc-metrics-list").append(a)}},function(){})}},{key:"openConnectedDataConfiguration",value:function(){$("#connectedDataConfigModal").modal("show"),$("#connectedDataConfigModal").hasClass("content-loaded")||this.createConnectedDataConfigLayout()}},{key:"closeConnectedDataConfiguration",value:function(){$("#connectedDataConfigModal").modal("hide")}},{key:"createConnectedDataConfigLayout",value:function(){var t,e,a=this;Object.keys(a.subEntityList).forEach(function(t){var e=Handlebars.compile(a.connectedData.tabMenu)({transid:t,caption:a.subEntityList[t]});$("#connectedDataTabMenu").append(e);var n=Handlebars.compile(a.connectedData.tabBody)({transid:t,caption:a.subEntityList[t]});$("#connectedDataTabBody").append(n),a.constructedConnectedDataFieldsList(t)}),a.constructCustomHyperlinksContainer(),Object.keys(a.connectedDataFields).forEach(function(t){a.connectedDataFields[t].forEach(function(e){var a=e.fieldname,n=e.condition,i="chk_".concat(n,"_").concat(a),o=document.getElementById(i);o&&o.getAttribute("data-transid")===t&&(o.checked=!0)})}),$("#connectedDataConfigModal").addClass("content-loaded"),null===(t=$("#connectedDataConfigModal #connectedDataTabMenu .nav-link"))||void 0===t||null===(e=t[0])||void 0===e||e.click()}},{key:"constructedConnectedDataFieldsList",value:function(t){var e=this.metaData.filter(function(e){return e.ftransid===t&&"T"===e.aggfield&&"F"===e.hide&&"F"==e.griddc}),a={};e.forEach(function(t){a[t.dcname]||(a[t.dcname]=[]),a[t.dcname].push(t)});var n="";Object.entries(a).forEach(function(t){var e=_slicedToArray(t,2),a=e[0],i=e[1],o=_entityForm.entityFormJson.metadata.find(function(t){return t.fname==a}).caption||a;n+='\n        <div class="card KC_Items">\n            <div class="card-header collapsible cursor-pointer rotate  '.concat("",'" data-bs-toggle="collapse" aria-expanded="true" data-bs-target="#conn-fields-').concat(a,'">\n                <h3 class="card-title">').concat(o," (").concat(a,')</h3>\n                <div class="card-toolbar rotate-180">\n                    <span class="material-icons material-icons-style material-icons-2">\n                        expand_circle_down\n                    </span>\n                </div>\n            </div>\n            <div class="KC_Items_Content collapse ').concat("show",' heightControl pt-0---" id="conn-fields-').concat(a,'">\n            <table class="table table-hover">\n                <thead>\n                    <tr>\n                        <th>Field Name</th>\n                        <th>Sum</th>\n                        <th>Avg</th>\n                    </tr>\n                </thead>\n                <tbody>'),i.forEach(function(t){n+='<tr>\n                        <td><label for="chk_'.concat(t.fldname,'">').concat(t.fldcap||""," (").concat(t.fldname,')</label></td>\n                        <td><input type="checkbox" id="chk_sum_').concat(t.fldname,'" class="chk-sum" value="sum_').concat(t.fldname,'" data-dcname="').concat(a,'" data-transid="').concat(t.ftransid,'" data-fieldname="').concat(t.fldname,'" data-condition="sum"></td>\n                        <td><input type="checkbox" id="chk_avg_').concat(t.fldname,'" class="chk-avg" value="avg_').concat(t.fldname,'" data-dcname="').concat(a,'" data-transid="').concat(t.ftransid,'" data-fieldname="').concat(t.fldname,'" data-condition="avg"></td>\n                    </tr>')}),n+="</tbody></table></div></div>"}),n?$("#connecteddata-fieldslist-".concat(t)).html(n):$("#connecteddata-fieldslist-".concat(t)).html("No fields availabe for configuration.")}},{key:"constructCustomHyperlinksContainer",value:function(){var t,e=$("#hyperlinkGridBody"),a=$("#addRowBtn");function n(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},a='\n                <tr>\n                    <td class="serial-number">'.concat(e.find("tr").length+1,'</td>\n                    <td>\n                        <input type="text" class="form-control hyperlink-name" \n                               placeholder="Hyperlink Name" \n                               value="').concat(t.hyperlinkcaption||"",'" required>\n                    </td>\n                    <td>\n                        <input type="text" class="form-control link-url" \n                               placeholder="Enter Link" \n                               value="').concat(t.link||"",'" required>\n                    </td>\n                    <td class="text-center">\n                        <button class="btn btn-sm delete-row" type="button">\n                            <i class="material-icons">delete</i>\n                        </button>\n                    </td>\n                </tr>\n            ');e.append(a),i()}if(n(),(null===(t=this.customHyperLinks)||void 0===t?void 0:t.length)>0)try{e.empty(),this.customHyperLinks.forEach(function(t){n(t)})}catch(o){alert("Invalid JSON: "+o.message)}function i(){e.find(".delete-row").prop("disabled",e.find("tr").length<=1)}a.on("click",function(){n()}),e.on("click",".delete-row",function(){e.find("tr").length>1&&($(this).closest("tr").remove(),e.find("tr").each(function(t){$(this).find(".serial-number").text(t+1)}),i())})}},{key:"getCustomHyperLinksJSON",value:function(){var t=$("#hyperlinkGridBody"),e=[];return t.find("tr").each(function(){var t=$(this).find(".hyperlink-name").val().trim(),a=$(this).find(".link-url").val().trim();t&&a&&e.push({hyperlinkcaption:t,link:a})}),e}},{key:"getConnectedDataSelectionJSON",value:function(){var t={};return document.querySelectorAll(".chk-sum:checked, .chk-avg:checked").forEach(function(e){var a=e.getAttribute("data-transid"),n=e.getAttribute("data-fieldname"),i=e.getAttribute("data-condition");t[a]||(t[a]=[]),t[a].push({fieldname:n,condition:i})}),t}},{key:"getSelectedRelatedDataFieldsSelection",value:function(){var t=document.querySelectorAll(".chk-relateddataflds:checked");if(0!==t.length){var e="",a=!1;if(t.forEach(function(t){var n=t.value,i=t.dataset.dcname;a||(a="dc1"===t.dataset.dcname),e+="".concat(i,"~").concat(n,",")}),a){e.endsWith(",")&&(e=e.substr(0,e.length-1)),this.relatedDataFields=e,t=document.querySelectorAll(".chk-displayflds:checked"),e="",t.forEach(function(t){var a=t.value,n=t.dataset.dcname;e+="".concat(n,"~").concat(a,",")}),e.endsWith(",")&&(e=e.substr(0,e.length-1));var n="",i="",o={};t.forEach(function(t){var e="".concat(t.dataset.dcname,"~").concat(t.dataset.griddc);o[e]||(o[e]=[]);var a=t.value;o[e].push(a)}),Object.entries(o).forEach(function(t){var e=_slicedToArray(t,2),a=e[0],o=e[1],c="T"==a.split("~")[1],r=_entityForm.metaData.find(function(t){return t.fldname===o[0]&&t.ftransid==_entityForm.entityTransId});c?(i+="".concat(r.tablename,"="),o.forEach(function(t){var e=_entityForm.metaData.find(function(e){return e.fldname===t});i+="".concat(e.fldname,"~").concat(e.normalized,"~").concat(e.srctable||"","~").concat(e.srcfield||"","~").concat(e.allowempty,"|")}),i.endsWith("|")&&(i=i.substr(0,i.length-1)),i+="^"):(n+="".concat(r.tablename,"="),o.forEach(function(t){var e=_entityForm.metaData.find(function(e){return e.fldname===t&&e.ftransid==_entityForm.entityTransId});n+="".concat(e.fldname,"~").concat(e.normalized,"~").concat(e.srctable||"","~").concat(e.srcfield||"","~").concat(e.allowempty,"|")}),n.endsWith("|")&&(n=n.substr(0,n.length-1)),n+="^")}),n.endsWith("^")&&(n=n.substr(0,n.length-1)),i.endsWith("^")&&(i=i.substr(0,i.length-1)),this.relatedDataDisplayFields=n,this.relatedDataDisplayGridFields=i}else showAlertDialog("error","Error: No DC1 fields are selected. Please select atleast one DC1 field.")}else showAlertDialog("error","Error: No fields are selected.")}},{key:"resetConnectedDataConfig",value:function(){if(confirm("Reset the selections?")){var t=this,e={page:"ENTITY_FORM",transId:t.entityTransId,properties:{CONNECTEDDATA_CONFIG:JSON.stringify({HYPERLINKS:[],CONNECTEDDATA_METRICS:{},RELATEDDATAFIELDS:"",DISPLAYFIELDS:"",DISPLAYGRIDFIELDS:""})},confirmNeeded:!0,allUsers:!0};_entityCommon.setAnalyticsDataWS(e,function(){showAlertDialog("success","Changes applied successfully"),t.reloadEntityPage()},function(t){showAlertDialog("error",t.status+" "+t.statusText)})}}},{key:"applyConnectedDataConfig",value:function(){var t=this,e={page:"ENTITY_FORM",transId:t.entityTransId,properties:{CONNECTEDDATA_CONFIG:JSON.stringify({HYPERLINKS:t.getCustomHyperLinksJSON()||[],CONNECTEDDATA_METRICS:t.getConnectedDataSelectionJSON()||{},RELATEDDATAFIELDS:"",DISPLAYFIELDS:"",DISPLAYGRIDFIELDS:""})},confirmNeeded:!0,allUsers:!0};_entityCommon.setAnalyticsDataWS(e,function(){showAlertDialog("success","Changes applied successfully"),t.reloadEntityPage()},function(t){showAlertDialog("error",t.status+" "+t.statusText)})}},{key:"createOtherDataFieldsLayout",value:function(){var t=document.getElementById("fields-selection"),e=_entityForm.metaData.filter(function(t){return t.ftransid===_entityForm.entityTransId&&"F"===t.hide&&("DropDown"===t.cdatatype||"c"==t.fdatatype||"d"==t.fdatatype)}),a={};e.forEach(function(t){a[t.dcname]||(a[t.dcname]=[]),a[t.dcname].push(t)});var n="";Object.entries(a).forEach(function(t){var e=_slicedToArray(t,2),a=e[0],i=e[1],o=_entityForm.entityFormJson.metadata.find(function(t){return t.fname==a}).caption||a;n+='<div class="card KC_Items">\n                    <div class="card-header collapsible cursor-pointer rotate  '.concat("",'" data-bs-toggle="collapse" aria-expanded="true" data-bs-target="#rel-fields-').concat(a,'">\n                        <h3 class="card-title">').concat(o," (").concat(a,')</h3>\n                        <div class="card-toolbar rotate-180">\n                            <span class="material-icons material-icons-style material-icons-2">\n                                expand_circle_down\n                            </span>\n                        </div>\n                    </div>\n                    <div class="KC_Items_Content collapse ').concat("show",' heightControl pt-0---" id="rel-fields-').concat(a,'">\n                    <table class="table table-hover">\n                        <thead>\n                            <tr>\n                                <th>Field Name</th>\n                                <th>Show in right data panel</th>\n                                <th>Show in data panel listing </th>\n                            </tr>\n                        </thead>\n                        <tbody id="fields-table-body">'),i.forEach(function(t){n+="<tr>                        \n                        <td><label>".concat(t.fldcap||""," (").concat(t.fldname,')</label></td>\n                        <td><input type="checkbox" id="chk_').concat(t.fldname,'" class="chk-fields chk-relateddataflds" value="').concat(t.fldname,'" data-dcname="').concat(a,'"></td>\n                        <td><input type="checkbox" id="chkdisp_').concat(t.fldname,'" class="chk-fields chk-displayflds" value="').concat(t.fldname,'" data-dcname="').concat(a,'"></td>\n                    </tr>')}),n+="</tbody></table></div></div>"}),t.innerHTML=n,""!==this.relatedDataFields&&this.relatedDataFields.split(",").forEach(function(t){var e=t.split("~")[1];document.querySelector("#chk_".concat(e)).checked=!0}),""!==this.relatedDataDisplayFields&&this.relatedDataDisplayFields.split("^").forEach(function(t){t.split("|").forEach(function(t){var e=t.indexOf("=")>-1?t.split("~")[0].split("=")[1]:t.split("~")[0];document.querySelector("#chkdisp_".concat(e)).checked=!0})})}},{key:"fetchFilteredData",value:function(t,e,a,n,i){var o=this,c=o.metaData.find(function(e){return e.fldname===t&&e.ftransid===o.entityTransId}),r="F";(o.relatedDataDisplayFields.indexOf("=".concat(t,"~"))>-1||o.relatedDataDisplayFields.indexOf("|".concat(t,"~"))>-1||"dc1"==a&&("All"==o.relatedDataDisplayFields||""==o.relatedDataDisplayFields))&&(r="T");var s="".concat(t,"~").concat(c.normalized,"~").concat(c.srctable||"","~").concat(c.srcfield||"","~").concat(c.fdatatype||"","~").concat(r||"F","~").concat(c.tablename||"","| = '").concat(e.toLowerCase(),"'");o.filter=s,o.fields=o.relatedDataDisplayFields||"All",o.getEntityListDataForOtherData(1,"".concat(a).concat(i).concat(t),n)}},{key:"getKeyField",value:function(t){var e=this;if(e.subEntityKeyFields&&e.subEntityKeyFields[t])return{fldname:e.subEntityKeyFields[t]};var a=e.metaData.filter(function(e){return e.ftransid===t&&"F"===e.hide}),n=a.filter(function(t){return"Auto Generate"===t.cdatatype}).find(function(t){var a;return void 0!==(null===(a=e.entityFormJson.data.find(function(e){return e.n==t.fldname}))||void 0===a?void 0:a.v)});if(n)return n;var i=a.filter(function(t){return"F"===t.allowempty&&"F"===t.allowduplicate}).find(function(t){var a;return void 0!==(null===(a=e.entityFormJson.data.find(function(e){return e.n==t.fldname}))||void 0===a?void 0:a.v)});if(i)return i;var o=a.filter(function(t){return"F"===t.allowduplicate}).find(function(t){var a;return void 0!==(null===(a=e.entityFormJson.data.find(function(e){return e.n==t.fldname}))||void 0===a?void 0:a.v)});if(o)return o;var c=a.filter(function(t){return"F"===t.allowempty}).find(function(t){var a;return void 0!==(null===(a=e.entityFormJson.data.find(function(e){return e.n==t.fldname}))||void 0===a?void 0:a.v)});if(c)return c;var r=a.find(function(t){var a;return void 0!==(null===(a=e.entityFormJson.data.find(function(e){return e.n==t.fldname}))||void 0===a?void 0:a.v)});return r||a[0]}}]),t}();function getCaption(t){for(var e=_entityForm.entityFormJson.metadata,a=0;a<e.length;a++)if(e[a].fname===t)return e[a].caption;return null}function getHiddenFlag(t){for(var e=_entityForm.entityFormJson.metadata,a=0;a<e.length;a++)if(e[a].fname===t)return e[a].hidden;return null}function generateRowElements(t,e,a){var n='<div class="Data-fields-row">';if(a&&"Other Data"==a){n='<div class="Data-fields-row relateddata-row workflow-items">';var i,o=_createForOfIteratorHelper(_entityForm.entityWiseFields[e].otherElements);try{for(o.s();!(i=o.n()).done;){n+=generateHTMLBasedForOtherData(i.value,t)}}catch(m){o.e(m)}finally{o.f()}n.endsWith(",&nbsp;")&&(n=n.substr(0,n.length-7))}else{var c,r=_createForOfIteratorHelper(_entityForm.entityWiseFields[e].otherElements);try{for(r.s();!(c=r.n()).done;){n+=generateHTMLBasedOnDataType(c.value,t)}}catch(m){r.e(m)}finally{r.f()}var s,l=_createForOfIteratorHelper(_entityForm.entityWiseFields[e].largeTextElements);try{for(l.s();!(s=l.n()).done;){n+=generateHTMLBasedOnDataType(s.value,t)}}catch(m){l.e(m)}finally{l.f()}var d,u=_createForOfIteratorHelper(_entityForm.entityWiseFields[e].attachmentElements);try{for(u.s();!(d=u.n()).done;){n+=generateHTMLBasedOnDataType(d.value,t)}}catch(m){u.e(m)}finally{u.f()}}return n+="</div>",a&&"Other Data"==a&&(n=n.replaceAll("txt-bold"," ")),n}function generateRowButtonHTML(t,e){var a,n="",i=_createForOfIteratorHelper(_entityForm.entityWiseFields[e].buttonElements);try{for(i.s();!(a=i.n()).done;){n+='<div class="menu-item px-3 my-0">',n+=generateHTMLBasedOnDataType(a.value,t),n+="</div>"}}catch(o){i.e(o)}finally{i.f()}return n}function getFieldDataType(t){return _entityCommon.inValid(t.cdatatype)?"n"==t.fdatatype?"Number":"d"==t.fdatatype?"Date":"c"==t.fdatatype?"Text":"i"==t.fdatatype?"Image":"t"==t.fdatatype?"Large Text":"Text":t.cdatatype}function generateHTMLBasedOnDataType(t,e){var a,n=t.fldname;if(n==_entityForm.keyField&&e.transid==_entityForm.entityTransId||n==e.keycol&&e.transid==t.ftransid)return"";var i=getFieldDataType(t),o=t.fldcap||"",c=t.props,r=e[n];if(_entityCommon.inValid(r)&&"BUTTON"!=i.toUpperCase()||"transid"==t.fldname)return"";"BUTTON"!=i.toUpperCase()&&(r=null===(a=r)||void 0===a?void 0:a.toString().replace("T00:00:00",""));var s="";switch(i){case"Large Text":s='<div class=" Data-fields-items Department-field" data-toggle="tooltip" data-placement="top" title="'.concat(o,'" data-name="').concat(o.toLowerCase().replaceAll("*","").replaceAll(" ",""),'">\n                                               <p class="task-description moretext" style="margin-bottom:0px !important;">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t').concat(r,'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t </p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t <a class="moreless-button" href="#">Read more</a>\n                                            </div>');break;case"Short Text":s='<div class=" Data-fields-items Department-field" data-toggle="tooltip" data-placement="top" title="'.concat(o,'" data-name="').concat(o.toLowerCase().replaceAll("*","").replaceAll(" ",""),'">\n                                                <span class="material-icons material-icons-style material-icons-2 ">description</span><span class="txt-bold Data-field-value">').concat(r,"</span>\n                                            </div>");break;case"Currency":s='<div class=" Data-fields-items Department-field" data-toggle="tooltip" data-placement="top" title="'.concat(o,'" data-name="').concat(o.toLowerCase().replaceAll("*","").replaceAll(" ",""),'">\n                                                <span class="material-icons material-icons-style material-icons-2 ">payments</span><span class="txt-bold Data-field-value">').concat(r,"</span>\n                                            </div>");break;case"Date":s='<div class=" Data-fields-items Date-field" data-toggle="tooltip" data-placement="top" title="'.concat(o,'" data-name="').concat(o.toLowerCase().replaceAll("*","").replaceAll(" ",""),'">\n                                                <span class="material-icons material-icons-style material-icons-2 ">today</span><span class="txt-bold Data-field-value"> Dec 14 2023 </span>\n                                            </div>');break;case"Time":s=' <div class=" Data-fields-items Time-field" data-toggle="tooltip" data-placement="top" title="'.concat(o,'" data-name="').concat(o.toLowerCase().replaceAll("*","").replaceAll(" ",""),'">\n                                                <span class="material-icons material-icons-style material-icons-2 ">schedule</span><span class="txt-bold Data-field-value">11:30 PM</span>\n                                            </div>');break;case"Link":s='<div class=" Data-fields-items link-field" data-toggle="tooltip" data-placement="top" title="'.concat(o,'" data-name="').concat(o.toLowerCase().replaceAll("*","").replaceAll(" ",""),'">\n                                                <span class="material-icons material-icons-style material-icons-2 ">link</span><span class="txt-bold Data-field-value">').concat(r,"</span>\n                                            </div>");break;case"Mobile":case"Phone":s='<div class=" Data-fields-items Email-field" data-toggle="tooltip" data-placement="top" title="'.concat(o,'" data-name="').concat(o.toLowerCase().replaceAll("*","").replaceAll(" ",""),'">\n                                                <span class="material-icons material-icons-style material-icons-2 ">phone</span><span class="txt-bold Data-field-value">').concat(r,"</span>\n                                            </div>");break;case"Pincode":case"Zipcode":s='<div class=" Data-fields-items Email-field" data-toggle="tooltip" data-placement="top" title="'.concat(o,'" data-name="').concat(o.toLowerCase().replaceAll("*","").replaceAll(" ",""),'">\n                                                <span class="material-icons material-icons-style material-icons-2 ">location_on</span><span class="txt-bold Data-field-value">').concat(r,"</span>\n                                            </div>");break;case"Email":s='<div class=" Data-fields-items Email-field truncate" data-toggle="tooltip" data-placement="top" title="'.concat(o,'" data-name="').concat(o.toLowerCase().replaceAll("*","").replaceAll(" ",""),'">\n                                                <span class="material-icons material-icons-style material-icons-2 ">mail</span><span class="txt-bold Data-field-value" data-text="').concat(r,'" onclick="showPopup(this)">').concat(r,"</span>\n                                            </div>");break;case"Bool":s="T"==r?'<div class=" Data-fields-items Email-field" data-toggle="tooltip" data-placement="top" title="'.concat(o,'" data-name="').concat(o.toLowerCase().replaceAll("*","").replaceAll(" ",""),'">\n                    <div class="form-check form-switch">\n                          <input class="form-check-input" type="checkbox" role="switch" checked disabled />\n                          <span class="txt-bold Data-field-value">').concat(o,"</span>\n                        </div></div>"):'<div class=" Data-fields-items Email-field" data-toggle="tooltip" data-placement="top" title="'.concat(o,'" data-name="').concat(o.toLowerCase().replaceAll("*","").replaceAll(" ",""),'">\n                    <div class="form-check form-switch" style="padding-top: 5px;">\n                          <input class="form-check-input" type="checkbox" role="switch" disabled />\n                          <span class="txt-bold Data-field-value">').concat(o,"</span>\n                        </div></div>");break;case"button":var l=c.split("|")[0].split("~")[1];s='<a href="javascript:void(0)" title="View form"\n                                                   class="btn btn-white btn-color-gray-700 btn-active-primary d-inline-flex align-items-center  btn-sm  me-2 ">\n                                                    <span class="material-icons material-icons-style material-icons-2"\n                                                          style="color: darkmagenta;">'.concat(l,"</span>").concat(o,"\n                                                </a>");break;case"Attachments":var d=getIconClass(getFileType(r));s='<div class="Files-Attached " data-toggle="tooltip" data-placement="top" title="'.concat(o,'" data-name="').concat(o.toLowerCase().replaceAll("*","").replaceAll(" ",""),'">\n\t\t\t\t\t\t   ').concat(d,'\t\n\t\t\t\t\t\t   <div class="ms-1 fw-semibold">\t\t\t\t\t\t\t  \n\t\t\t\t\t\t\t  <a class="attached-filename" onclick="downloadFileFromPath(\'').concat("","','").concat(r,"')\">").concat(r,"</a>\t\t\t\t\t\t  \t\t\t\t\t\t\t  \n\t\t\t\t\t\t   </div>\t\t\t\t\t\t  \t\t\t\t\t\t   \n\t\t\t\t\t\t</div>");break;default:s='<div class=" Data-fields-items Department-field" data-toggle="tooltip" data-placement="top" title="'.concat(o,'" data-name="').concat(o.toLowerCase().replaceAll("*","").replaceAll(" ",""),'">\n                                                <span class="txt-bold Data-field-value">').concat(r,"</span>\n                                            </div>")}return s}function generateHTMLBasedForOtherData(t,e){var a,n=t.fldname;if(n==_entityForm.keyField&&e.transid==_entityForm.entityTransId||n==e.keycol&&e.transid==t.ftransid)return"";getFieldDataType(t);var i=t.fldcap||"",o=(t.props,e[n]);return _entityCommon.inValid(o)||"transid"==t.fldname?"":(o=null===(a=o)||void 0===a?void 0:a.toString().replace("T00:00:00",""),'<div class="" data-toggle="tooltip" data-placement="top" title="'.concat(i,'" data-name="').concat(i.toLowerCase().replaceAll("*","").replaceAll(" ",""),'">\n                <span class="txt-bold Data-field-value">').concat(o,"</span>\n            </div>,&nbsp;"))}function isScrollAtBottomWithinDiv(t){return t.scrollHeight-(t.scrollTop+t.clientHeight)<=1}function isScrollAtTopWithinDiv(t){return t.scrollTop<=1}function filterRowsByPage(t,e){return t.filter(function(t){return t.pageno===e})}function getMaxPageNumber(t){var e=-Infinity;return t.forEach(function(t){t.pageno>e&&(e=t.pageno)}),e}function initReadMore(){document.querySelectorAll(".moretext").forEach(function(t,e){var a=t.clientHeight,n=t.nextElementSibling;t.scrollHeight>t.clientHeight?(n.style.display="inline-block",t.style.maxHeight=a+"px"):n.style.display="none",n.addEventListener("click",function(){var e=window.getComputedStyle(t);"none"===e.maxHeight||e.maxHeight===a+"px"?(t.style.maxHeight=t.scrollHeight+"px",n.textContent="Read less"):(t.style.maxHeight=a+"px",n.textContent="Read more")})})}function getFilesHtml(t){var e="",a=t.axpfile_file.split(",");return $.each(a,function(a,n){var i=getFileType(n),o=getIconClass(i),c=t.axpfilepath_file+n;c=c.replace(/\\/g,"\\\\"),""!=n&&(e+='<div class="Files-Attached ">\n\t\t\t\t\t\t   '.concat(o,'\t\t\t\t\t\t   \n\t\t\t\t\t\t   <div class="ms-1 fw-semibold">\t\t\t\t\t\t  \n\t\t\t\t\t\t\t  <a class="attached-filename" onclick="downloadFileFromPath(\'').concat(c,"','").concat(n,"')\">").concat(n,'</a>                    \n\t\t\t\t\t\t\t  <div class="attached-filedetails">\n\t\t\t\t\t\t\t\t <span class="doctype">').concat(i,"</span>\n\t\t\t\t\t\t\t  </div>\n\t\t\t\t\t\t   </div>\n\t\t\t\t\t\t</div>"))}),e}function getIconClass(t){switch(t){case"pdf":return'<img src="../images/pdf.svg" class="file-img" />';case"jpeg":case"jpg":case"png":return'<img src="../images/images.svg" class="file-img" />';case"doc":case"docx":return'<img src="../images/word.svg" class="file-img" />';case"txt":return'<i style="margin:0px !important; font-size: 40px !important; " class="material-icons">description</i>';case"xls":case"xlsx":return'<img src="../images/xl.svg" class="file-img"/>';case"ppt":case"pptx":return'<img src="../images/ppt.svg" class="file-img"/>';case"zip":return'<i style="margin:0px !important; font-size: 40px !important; " class="material-icons">archive</i>';case"mp3":return'<i style="margin:0px !important; font-size: 40px !important; " class="material-icons">audiotrack</i>';case"mp4":return'<i style="margin:0px !important; font-size: 40px !important; " class="material-icons">videocam</i>';default:return'<i style="margin:0px !important; font-size: 40px !important; " class="material-icons">insert_drive_file</i>'}}function getFileType(t){var e=t.split(".");return e[e.length-1].toLowerCase()}function scrollToTopOfDiv(t){t.scrollTop=0}function showPopup(t){var e=t.getAttribute("data-text");document.getElementById("popupText").textContent=e,$("#myModal").modal("show")}function openFieldSelection(){$("#fieldsModal").modal("show"),""==$("#fields-selection").html()&&createOtherDataFieldsLayout()}function openDisplayFieldSelection(){$("#displayFieldsModal").modal("show"),""==$("#displayfields-selection").html()&&createDisplayFieldsLayout()}function createDisplayFieldsLayout(){var t=document.getElementById("displayfields-selection"),e=new Set;relatedDataFields.split(",").forEach(function(t){var a=t.split("~")[0];e.add(a)});var a=Array.from(e),n=_entityForm.metaData.filter(function(t){return t.ftransid===_entityForm.entityTransId&&"F"===t.hide&&a.includes(t.dcname)}),i={};n.forEach(function(t){i[t.dcname]||(i[t.dcname]=[]),i[t.dcname].push(t)});var o="";Object.entries(i).forEach(function(t){var e=_slicedToArray(t,2),a=e[0],n=e[1],i=!0;"dc1"==a&&(i=!1);var c=_entityForm.entityFormJson.metadata.find(function(t){return t.fname==a}),r=c.caption||a;o+='\n        <div class="card KC_Items">\n            <div class="card-header collapsible cursor-pointer rotate  '.concat(i?"collapsed":"",'" data-bs-toggle="collapse" aria-expanded="true" data-bs-target="#fields-').concat(a,'">\n                <h3 class="card-title">').concat(r," (").concat(a,')</h3>\n                <div class="card-toolbar rotate-180">\n                    <span class="material-icons material-icons-style material-icons-2">\n                        expand_circle_down\n                    </span>\n                </div>\n            </div>\n            <div class="KC_Items_Content collapse ').concat(i?"":"show",' heightControl pt-0---" id="fields-').concat(a,'">\n            <table class="table table-hover">\n                <tbody id="fields-table-body">'),n.forEach(function(t){o+='<tr><td><input type="checkbox" id="chkdisp_'.concat(t.fldname,'" class="chk-fields chk-displayflds" value="').concat(t.fldname,'" data-fldcap="').concat(t.fldcap||"",'" data-dcname="').concat(a,'" data-griddc="').concat(c.customdatatype||"T",'"></td>\n          <td><label for="chkdisp_').concat(t.fldname,'">').concat(t.fldcap||""," (").concat(t.fldname,")</label></td></tr>")}),o+="</tbody></table></div></div>"}),t.innerHTML=o,""!==relatedDataDisplayFields&&relatedDataDisplayFields.split("^").forEach(function(t){t.split("|").forEach(function(t){var e=t.indexOf("=")>-1?t.split("~")[0].split("=")[1]:t.split("~")[0];document.querySelector("#chkdisp_".concat(e)).checked=!0})});var c=document.querySelector("#chkdisp_".concat(_entityForm.keyField));c&&(c.checked=!0,c.disabled=!0)}function fieldsModelClose(){$("#fieldsModal").modal("hide")}function displayFieldsModelClose(){$("#displayFieldsModal").modal("hide")}function applyRelatedDataFields(){var t=document.querySelectorAll(".chk-relateddataflds:checked");if(0!==t.length){var e="",a=!1;t.forEach(function(t){var n=t.value,i=t.dataset.dcname;a||(a="dc1"===t.dataset.dcname),e+="".concat(i,"~").concat(n,",")}),a?(e.endsWith(",")&&(e=e.substr(0,e.length-1)),_entityForm.relatedDataFields=e,_entityForm.setSelectedRelatedFields()):showAlertDialog("error","Error: No DC1 fields are selected. Please select atleast one DC1 field.")}else showAlertDialog("error","Error: No fields are selected.")}function resetRelatedDataFields(){_entityForm.relatedDataFields="",_entityForm.setSelectedRelatedFields()}function applyDisplayFields(){var t=document.querySelectorAll(".chk-displayflds:checked");if(0!==t.length){var e="";t.forEach(function(t){var a=t.value,n=t.dataset.dcname;e+="".concat(n,"~").concat(a,",")}),e.endsWith(",")&&(e=e.substr(0,e.length-1));var a="",n="",i={};t.forEach(function(t){var e="".concat(t.dataset.dcname,"~").concat(t.dataset.griddc);i[e]||(i[e]=[]);var a=t.value;i[e].push(a)}),Object.entries(i).forEach(function(t){var e=_slicedToArray(t,2),i=e[0],o=e[1],c="T"==i.split("~")[1],r=_entityForm.metaData.find(function(t){return t.fldname===o[0]&&t.ftransid==_entityForm.entityTransId});c?(n+="".concat(r.tablename,"="),o.forEach(function(t){var e=_entityForm.metaData.find(function(e){return e.fldname===t});n+="".concat(e.fldname,"~").concat(e.normalized,"~").concat(e.srctable||"","~").concat(e.srcfield||"","~").concat(e.allowempty,"|")}),n.endsWith("|")&&(n=n.substr(0,n.length-1)),n+="^"):(a+="".concat(r.tablename,"="),o.forEach(function(t){var e=_entityForm.metaData.find(function(e){return e.fldname===t&&e.ftransid==_entityForm.entityTransId});a+="".concat(e.fldname,"~").concat(e.normalized,"~").concat(e.srctable||"","~").concat(e.srcfield||"","~").concat(e.allowempty,"|")}),a.endsWith("|")&&(a=a.substr(0,a.length-1)),a+="^")}),a.endsWith("^")&&(a=a.substr(0,a.length-1)),n.endsWith("^")&&(n=n.substr(0,n.length-1)),_entityForm.relatedDataDisplayFields=a,_entityForm.relatedDataDisplayGridFields=n,_entityForm.setSelectedDisplayFields()}else showAlertDialog("error","Error: No fields are selected.")}function resetDisplayFields(){_entityForm.relatedDataDisplayFields="All",_entityForm.relatedDataDisplayGridFields="",_entityForm.setSelectedDisplayFields()}function searchFields(){var t=document.getElementById("searchBar").value.toLowerCase();document.querySelectorAll('[id^="fields-dc"]').forEach(function(e){for(var a=e.getElementsByTagName("tr"),n=0;n<a.length;n++){a[n].getElementsByTagName("label")[0].innerText.toLowerCase().includes(t)?a[n].style.display="":a[n].style.display="none"}})}function formmatingtoillions(t){return 0!==Object.values(window.top.allGloblVars.globalVars).map(function(t){return t}).filter(function(t){return t.millions}).length&&"T"===Object.values(window.top.allGloblVars.globalVars).map(function(t){return t}).filter(function(t){return t.millions})[0].millions||!1?InsertCommas(t):formatIndianNumber(t)}function InsertCommas(t){var e=parseFloat(t);isNaN(e)&&(e=0);var a="";return e<0&&(a="-"),e=Math.abs(e),e=parseInt(100*(e+.005)),e/=100,s=new String(e),s.indexOf(".")<0&&(s+=".00"),s.indexOf(".")===s.length-2&&(s+="0"),s=a+s,CommaFormatted(s)}function CommaFormatted(t){var e="";-1===t.toString().indexOf(".")&&(t+=".");var a="";(e=t.split(".")).length>1&&(a=e[1].toString());var n=parseInt(e[0]);if(isNaN(n))return"";var i="";t<0&&(i="-"),n=Math.abs(n);var o=new String(n);e=[];try{if(Parameters.length>0&&Parameters.indexOf("millions~T")>-1)for(;o.length>3;){var c=o.substr(o.length-3);e.unshift(c),o=o.substr(0,o.length-3)}else{if(o.length>3){c=o.substr(o.length-3);e.unshift(c),o=o.substr(0,o.length-3)}for(;o.length>2;){c=o.substr(o.length-2);e.unshift(c),o=o.substr(0,o.length-2)}}}catch(r){for(;o.length>3;){c=o.substr(o.length-3);e.unshift(c),o=o.substr(0,o.length-3)}}return o.length>0&&e.unshift(o),o=e.join(","),t=i+(t=a.length<1?o:o+"."+a)}function formatIndianNumber(t){if(isNaN(t))return"";var e=Math.abs(parseInt(t,10)).toString(),a="";for(e.length>3&&(a=","+e.slice(-3),e=e.slice(0,-3));e.length>2;)a=","+e.slice(-2)+a,e=e.slice(0,-2);return e.length>0&&(a=e+a),(t<0?"-":"")+a}function formatDateString(t){if(!t)return"";var e=t.split("T"),a=e[0].split("-"),n=(e[1]||"00:00:00").split(":"),i=a[0],o=a[1],c=a[2],r=n[0],s=n[1],l=n[2],d="en-us"===dtCulture?"".concat(o,"/").concat(c,"/").concat(i):"".concat(c,"/").concat(o,"/").concat(i),u="00"!==r||"00"!==s||"00"!==l?"".concat(r,":").concat(s,":").concat(l):"";return u?"".concat(d," ").concat(u):d}function ShowHideDimmer(t){try{"undefined"!=typeof parent.ShowDimmer&&parent.ShowDimmer(t),"undefined"!=typeof ShowDimmer&&ShowDimmer(t),"undefined"!=typeof window.top.ShowDimmer&&window.top.ShowDimmer(t)}catch(e){}}$(document).ready(function(){_entityForm=new EntityForm,_entityCommon=new EntityCommon,_entityForm.init()});
